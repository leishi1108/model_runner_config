[DEFAULT]
workspace = /home/shilei/fbpmx/aecloud_rebuild/pricelib_rebuild_${date}

[project]
actions = generate, run
datasets = aecloud_pricelib_dataset, price_library_mergeALL_label, price_library_property_fixed_label
stages = aecloud_pricelib_write

[dataset_aecloud_pricelib_dataset]
class = GlodonAECloudDataset
domain = aecloud-test.glodon.com
domainModelCode = dcostSubcontractPrice
apiId = 340000
apiVerifyId = 714710722


[dataset_raw_price_library_dataset]
class = ReadExcelLackKeyDataset
key_cols = uid
feature_cols = specialty, costPartial, element, material, sequence, expense, group, building, floor, section, supporting, lot, upOrDown, system, locElement
dir = /home/shilei/corpus/cost_split/分包指导价属性/02-中化学-全专业-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/03-中建二局华东-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/04-邢台路桥-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/05-中交一公局北京建筑-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/06-中铁七局武汉（房建+公路+市政）-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/07-安徽十七冶-土建路桥-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/08-一冶-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/09-天健建工-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/10-湖北交投-土建市政-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/11-水电九局-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/12-中铁建工五建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/13-兴泰建设-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/15-十五局五-土建安装-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/16-中铁十一电务-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/17-中铁二十五局-土建基建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/18-中铁建工深圳-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/19-中铁建工北京-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/21-中铁建工西南-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/22-中铁建工四川-土建安装-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/24-贵州省建设-上寨-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/24-贵州省建设-土建安装-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/26-亚泰建筑-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/27-八局四-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/28-中化学-海南-土建市政-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/29-中铁十局二-土建市政-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/30-十五冶-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/31-中铁建设南方-土建安装-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/32-中铁五局装饰-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/33-七冶土木-土建市政-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/34-中铁二十三局六-土建市政-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/35-湖北工建-土建安装-解析预期结果(工程数据分包指导价).xlsx,/home/shilei/corpus/cost_split/分包指导价属性/36-兴泰科装-土建装饰安装-解析预期结果(工程数据分包指导价).xlsx,/home/shilei/corpus/cost_split/分包指导价属性/37-中建五局广分-土建装饰-解析预期结果(工程数据分包指导价).xlsx,/home/shilei/corpus/cost_split/分包指导价属性/38-中冶天工-土建装修市政-解析预期结果(工程数据分包指导价).xlsx,/home/shilei/corpus/cost_split/分包指导价属性/39-中建二局安装-解析预期结果(工程数据分包指导价).xlsx,/home/shilei/corpus/cost_split/分包指导价属性/40-五冶市政-土建装修安装市政-解析预期结果(工程数据分包指导价).xlsx,/home/shilei/corpus/cost_split/分包指导价属性/41-中铁建大湾区-土建装修-解析预期结果(工程数据分包指导价).xlsx,/home/shilei/corpus/cost_split/分包指导价属性/42-八局装饰-土建装修安装园林-解析预期结果(工程数据分包指导价).xlsx,/home/shilei/corpus/cost_split/分包指导价属性/43-四川智数建设发展-装修-解析预期结果(工程数据分包指导价).xlsx,/home/shilei/corpus/cost_split/分包指导价属性/47-中建八局北京-土建装修-解析预期结果(工程数据分包指导价).xlsx


[dataset_raw_price_library_dataset_trans]
class = MapDataset
input = raw_price_library_dataset
expression = exec('import re; import uuid') or {"item_id": uuid.uuid3(uuid.NAMESPACE_DNS, str(x["filepath"]).split("/")[-1].split("-解析预期结果")[0] + "-" + str(x["uid"])).hex,
    "uid": str(x["uid"]),
    "list_key": str(x["filepath"]).split("/")[-1].split("-解析预期结果")[0] + "-" + str(x["uid"]),
    "item_name": x["名称"],
    "item_feature": x["项目特征"],
    "upper_item_name": x["分部全路径"],
    "pid": str(x["filepath"]).split("/")[-1].split("-解析预期结果")[0],
    "item_name_wk": f'清单名称: {x["名称"]}' if x["名称"] is not None else "",
    "item_feature_wk": f'清单特征: {x["项目特征"]}' if x["项目特征"] is not None else "",
    "upper_item_name_wk": f'全路径: {x["分部全路径"]}' if x["分部全路径"] is not None else "",

    "专业预期": ",".join(sorted(set(x["specialty"].split(",")))) if x["specialty"] is not None else "",
    "分部分项预期": ",".join(sorted(set(x["costPartial"].split(",")))) if x["costPartial"] is not None else "",
    "构件预期": ",".join(sorted(set(x["element"].split(",")))) if x["element"] is not None else "",
    "材料预期": ",".join(sorted(set(x["material"].split(",")))) if x["material"] is not None else "",

    "工序预期": ",".join(sorted(set(x["sequence"].split(",")))) if x["sequence"] is not None else "",
    "费用预期": ",".join(sorted(set(x["expense"].split(",")))) if x["expense"] is not None else "",
    "群体预期": ",".join(sorted(set(x["group"].split(",")))) if x["group"] is not None else "",
    "单体预期": ",".join(sorted(set(x["building"].split(",")))) if x["building"] is not None else "",
    "楼层预期": ",".join(sorted(set(str(x["floor"]).split(",")))) if x["floor"] is not None else "",
    "流水段预期": ",".join(sorted(set(x["section"].split(",")))) if x["section"] is not None else "",
    "空间预期": ",".join(sorted(set(x["space"].split(",")))) if x["space"] is not None else "",
    "配套建筑预期": ",".join(sorted(set(x["supporting"].split(",")))) if x["supporting"] is not None else "",
    "标段预期": ",".join(sorted(set(x["lot"].split(",")))) if x["lot"] is not None else "",
    "地上地下预期": ",".join(sorted(set(x["upOrDown"].split(",")))) if x["upOrDown"] is not None else "",
    "系统预期": ",".join(sorted(set(x["system"].split(",")))) if x["system"] is not None else "",
    "部位构件预期": ",".join(sorted(set(x["locElement"].split(",")))) if x["locElement"] is not None else "",
    }
keep_exists = True

[dataset_raw_price_library_dataset_dedup]
class = AccumulateDataset
input = raw_price_library_dataset_trans
deduplicate_by = list_key

####################### 原始预期汇总 #####################################

[dataset_price_library_specialty]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "专业预期": x["专业预期"]}

[dataset_price_library_specialty_grouped]
class = GroupedDataset
input = price_library_specialty
groupby = list_key
value_key = 专业预期

[dataset_price_library_partial]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "分部分项预期": x["分部分项预期"]}

[dataset_price_library_partial_grouped]
class = GroupedDataset
input = price_library_partial
groupby = list_key
value_key = 分部分项预期

[dataset_price_library_element]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "构件预期": x["构件预期"]}

[dataset_price_library_element_grouped]
class = GroupedDataset
input = price_library_element
groupby = list_key
value_key = 构件预期

[dataset_price_library_material]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "材料预期": x["材料预期"]}

[dataset_price_library_material_grouped]
class = GroupedDataset
input = price_library_material
groupby = list_key
value_key = 材料预期

[dataset_price_library_sequence]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "工序预期": x["工序预期"]}

[dataset_price_library_sequence_grouped]
class = GroupedDataset
input = price_library_sequence
groupby = list_key
value_key = 工序预期

[dataset_price_library_expense]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "费用预期": x["费用预期"]}

[dataset_price_library_expense_grouped]
class = GroupedDataset
input = price_library_expense
groupby = list_key
value_key = 费用预期

[dataset_price_library_group]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "群体预期": x["群体预期"]}

[dataset_price_library_group_grouped]
class = GroupedDataset
input = price_library_group
groupby = list_key
value_key = 群体预期

[dataset_price_library_building]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "单体预期": x["单体预期"]}

[dataset_price_library_building_grouped]
class = GroupedDataset
input = price_library_building
groupby = list_key
value_key = 单体预期

[dataset_price_library_floor]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "楼层预期": x["楼层预期"]}

[dataset_price_library_floor_grouped]
class = GroupedDataset
input = price_library_floor
groupby = list_key
value_key = 楼层预期

[dataset_price_library_section]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "流水段预期": x["流水段预期"]}

[dataset_price_library_section_grouped]
class = GroupedDataset
input = price_library_section
groupby = list_key
value_key = 流水段预期

[dataset_price_library_space]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "空间预期": x["空间预期"]}

[dataset_price_library_space_grouped]
class = GroupedDataset
input = price_library_space
groupby = list_key
value_key = 空间预期

[dataset_price_library_supporting]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "配套建筑预期": x["配套建筑预期"]}

[dataset_price_library_supporting_grouped]
class = GroupedDataset
input = price_library_supporting
groupby = list_key
value_key = 配套建筑预期

[dataset_price_library_lot]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "标段预期": x["标段预期"]}

[dataset_price_library_lot_grouped]
class = GroupedDataset
input = price_library_lot
groupby = list_key
value_key = 标段预期

[dataset_price_library_upOrDown]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "地上地下预期": x["地上地下预期"]}

[dataset_price_library_upOrDown_grouped]
class = GroupedDataset
input = price_library_upOrDown
groupby = list_key
value_key = 地上地下预期

[dataset_price_library_system]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "系统预期": x["系统预期"]}

[dataset_price_library_system_grouped]
class = GroupedDataset
input = price_library_system
groupby = list_key
value_key = 系统预期

[dataset_price_library_locElement]
class = MapDataset
input = raw_price_library_dataset_trans
expression = {"list_key": x["list_key"], "部位构件预期": x["部位构件预期"]}

[dataset_price_library_locElement_grouped]
class = GroupedDataset
input = price_library_locElement
groupby = list_key
value_key = 部位构件预期



[dataset_price_library_mergeElement]
class = MergeIntoDataset
base_dataset = raw_price_library_dataset_dedup
merge_datasets = price_library_element_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 构件预期
reset = False

[dataset_price_library_mergeMaterial]
class = MergeIntoDataset
base_dataset = price_library_mergeElement
merge_datasets = price_library_material_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 材料预期
reset = False

[dataset_price_library_mergePartial]
class = MergeIntoDataset
base_dataset = price_library_mergeMaterial
merge_datasets = price_library_partial_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 分部分项预期
reset = False

[dataset_price_library_mergeSpecialty]
class = MergeIntoDataset
base_dataset = price_library_mergePartial
merge_datasets = price_library_specialty_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 专业预期
reset = False


[dataset_price_library_mergeSequence]
class = MergeIntoDataset
base_dataset = price_library_mergeSpecialty
merge_datasets = price_library_sequence_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 工序预期
reset = False


[dataset_price_library_mergeExpense]
class = MergeIntoDataset
base_dataset = price_library_mergeSequence
merge_datasets = price_library_expense_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 费用预期
reset = False


[dataset_price_library_mergeGroup]
class = MergeIntoDataset
base_dataset = price_library_mergeExpense
merge_datasets = price_library_group_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 群体预期
reset = False

[dataset_price_library_mergeBuilding]
class = MergeIntoDataset
base_dataset = price_library_mergeGroup
merge_datasets = price_library_building_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 单体预期
reset = False

[dataset_price_library_mergeFloor]
class = MergeIntoDataset
base_dataset = price_library_mergeBuilding
merge_datasets = price_library_floor_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 楼层预期
reset = False

[dataset_price_library_mergeSection]
class = MergeIntoDataset
base_dataset = price_library_mergeFloor
merge_datasets = price_library_section_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 流水段预期
reset = False

[dataset_price_library_mergeSpace]
class = MergeIntoDataset
base_dataset = price_library_mergeSection
merge_datasets = price_library_space_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 空间预期
reset = False

[dataset_price_library_mergeSupporting]
class = MergeIntoDataset
base_dataset = price_library_mergeSpace
merge_datasets = price_library_supporting_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 配套建筑预期
reset = False

[dataset_price_library_mergeLot]
class = MergeIntoDataset
base_dataset = price_library_mergeSupporting
merge_datasets = price_library_lot_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 标段预期
reset = False

[dataset_price_library_mergeUpOrDown]
class = MergeIntoDataset
base_dataset = price_library_mergeLot
merge_datasets = price_library_upOrDown_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 地上地下预期
reset = False

[dataset_price_library_mergeSystem]
class = MergeIntoDataset
base_dataset = price_library_mergeUpOrDown
merge_datasets = price_library_system_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 系统预期
reset = False

[dataset_price_library_mergeLocElement]
class = MergeIntoDataset
base_dataset = price_library_mergeSystem
merge_datasets = price_library_locElement_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 部位构件预期
reset = False


[dataset_price_library_mergeALL_valid]
class = FilterDataset
input = price_library_mergeLocElement
filters = x["专业预期"] in ["土建专业", "装修专业"]


[dataset_price_library_mergeALL_label]
class = MapDataset
input = price_library_mergeALL_valid
expression = {
    "specialty_label": list(sorted(x["专业预期"].split(","))) if x["专业预期"] is not None and len(x["专业预期"])>0 else [],
    "costPartial_label": list(sorted(x["分部分项预期"].split(","))) if x["分部分项预期"] is not None and len(x["分部分项预期"])>0 else [],
    "element_label": list(sorted(x["构件预期"].split(","))) if x["构件预期"] is not None and len(x["构件预期"])>0 else [],
    "material_label": list(sorted(x["材料预期"].split(","))) if x["材料预期"] is not None and len(x["材料预期"])>0 else [],

    "sequence_label": list(sorted(x["工序预期"].split(","))) if x["工序预期"] is not None and len(x["工序预期"])>0 else [],
    "expense_label": list(sorted(x["费用预期"].split(","))) if x["费用预期"] is not None and len(x["费用预期"])>0 else [],

    "group_label": list(sorted(x["群体预期"].split(","))) if x["群体预期"] is not None and len(x["群体预期"])>0 else [],
    "building_label": list(sorted(x["单体预期"].split(","))) if x["单体预期"] is not None and len(x["单体预期"])>0 else [],
    "floor_label": list(sorted(x["楼层预期"].split(","))) if x["楼层预期"] is not None and len(x["楼层预期"])>0 else [],
    "section_label": list(sorted(x["流水段预期"].split(","))) if x["流水段预期"] is not None and len(x["流水段预期"])>0 else [],
    "space_label": list(sorted(x["空间预期"].split(","))) if x["空间预期"] is not None and len(x["空间预期"])>0 else [],
    "supporting_label": list(sorted(x["配套建筑预期"].split(","))) if x["配套建筑预期"] is not None and len(x["配套建筑预期"])>0 else [],
    "lot_label": list(sorted(x["标段预期"].split(","))) if x["标段预期"] is not None and len(x["标段预期"])>0 else [],
    "upOrDown_label": list(sorted(x["地上地下预期"].split(","))) if x["地上地下预期"] is not None and len(x["地上地下预期"])>0 else [],

    "system_label": list(sorted(x["系统预期"].split(","))) if x["系统预期"] is not None and len(x["系统预期"])>0 else [],
    "locElementlabel": list(sorted(x["部位构件预期"].split(","))) if x["部位构件预期"] is not None and len(x["部位构件预期"])>0 else [],

    }
keep_exists = True

############################## 枚举属性预期 ####################################

[dataset_raw_price_library_enum_property_fixed]
class = ReadExcelDataset
dir = /home/shilei/corpus/cost_split/分包指导价属性/分包指导价属性土建装修.xlsx
header_row = 0


[dataset_price_library_enum_property_fixed]
class = MapDataset
input = raw_price_library_enum_property_fixed
expression = {"list_key": str(x["清单id"]),
    "构件预期": x["构件预期"] if "构件预期修改" not in x or x["构件预期修改"] is None else "" if x["构件预期修改"] == "无构件" else ",".join(sorted(set(x["构件预期修改"].split(",")))),
    "材料预期": x["材料预期"] if "材料预期修改" not in x or x["材料预期修改"] is None else "" if x["材料预期修改"] == "无材料" else ",".join(sorted(set(x["材料预期修改"].split(",")))),
    "构件属性预期": x["构件属性预期"] if "构件属性预期修改" not in x or x["构件属性预期修改"] is None else "" if x["构件属性预期修改"] == "无构件属性" else ",".join(sorted(set(x["构件属性预期修改"].split(",")))),
    "材料属性预期": x["材料属性预期"] if "材料属性预期修改" not in x or x["材料属性预期修改"] is None else "" if x["材料属性预期修改"] == "无材料属性" else ",".join(sorted(set(x["材料属性预期修改"].split(",")))),
    }

[dataset_price_library_enum_property_merge]
class = MergeIntoDataset
base_dataset = price_library_mergeALL_label
merge_datasets = price_library_enum_property_fixed
merge_type = only_replace
merge_key = list_key
merge_values = 构件预期, 材料预期, 构件属性预期, 材料属性预期
reset = False

############################## 数值属性预期 ####################################

[dataset_raw_price_library_num_property_fixed]
class = ReadExcelDataset
dir = /home/shilei/corpus/cost_split/分包指导价属性/分包指导价数值属性土建装修.xlsx
header_row = 0

[dataset_price_library_num_property_fixed]
class = MapDataset
input = raw_price_library_num_property_fixed
expression = {"list_key": str(x["清单id"]),
    "构件预期": x["构件预期"] if "构件预期修改" not in x or x["构件预期修改"] is None else "" if x["构件预期修改"] == "无构件" else ",".join(sorted(set(x["构件预期修改"].split(",")))),
    "材料预期": x["材料预期"] if "材料预期修改" not in x or x["材料预期修改"] is None else "" if x["材料预期修改"] == "无材料" else ",".join(sorted(set(x["材料预期修改"].split(",")))),
    "构件数值属性原始预期": x["构件数值属性原始预期"] if "构件数值属性原始预期修改" not in x or x["构件数值属性原始预期修改"] is None else None if x["构件数值属性原始预期修改"] == "无构件属性" else x["构件数值属性原始预期修改"],
    "材料数值属性原始预期": x["材料数值属性原始预期"] if "材料数值属性原始预期修改" not in x or x["材料数值属性原始预期修改"] is None else None if x["材料数值属性原始预期修改"] == "无材料属性" else x["材料数值属性原始预期修改"],
    }


[dataset_price_library_num_property_fixed_merge]
class = MergeIntoDataset
base_dataset = price_library_enum_property_merge
merge_datasets = price_library_num_property_fixed
merge_type = only_replace
merge_key = list_key
merge_values = 构件数值属性原始预期, 材料数值属性原始预期
reset = False

#############################################################################

[dataset_price_library_property_fixed_label]
class = MapDataset
input = price_library_num_property_fixed_merge
expression = exec('import re; import uuid') or {
    "element_label": list(sorted(x["构件预期"].split(","))) if x["构件预期"] is not None and len(x["构件预期"])>0 else [],
    "material_label": list(sorted(x["材料预期"].split(","))) if x["材料预期"] is not None and len(x["材料预期"])>0 else [],

    "element_property_label": list(sorted(x["构件属性预期"].split(","))) if "构件属性预期" in x and x["构件属性预期"] is not None and len(x["构件属性预期"])>0 else [],
    "material_property_label": list(sorted(x["材料属性预期"].split(","))) if "材料属性预期" in x and x["材料属性预期"] is not None and len(x["材料属性预期"])>0 else [],

    "构件_数值属性名称预期": sorted(set(map(lambda x: "_".join(x.split("=#=")[:2]), x["构件数值属性原始预期"].split("|")))) if x["构件数值属性原始预期"] is not None else [],
    "element_num_property_label": sorted(set(map(lambda x: "_".join(x.split("=#=")[:2]+[ "".join( map( lambda x: f'{round(float(x["std"])*1e4)}'.zfill(8), eval(x.split("=#=")[2]) ) )  if len( eval(x.split("=#=")[2]) ) == 2 else "".join( map( lambda x: f'{round(float(x["std"])*1e4)}'.zfill(8) + "0"*8 if x["flag"] == "single" or ( "sign" in x and x["sign"] in [ "upper", "upperorequal", ] ) else "0"*8 + f'{round(float(x["std"])*1e4)}'.zfill(8) if "sign" in x and x["sign"] in [ "lower", "lowerorequal", ] else "0"*16 , eval(x.split("=#=")[2]) ) ) if len( eval(x.split("=#=")[2]) ) == 1 else "0"*16  ] ) , x["构件数值属性原始预期"].split("|")))) if x["构件数值属性原始预期"] is not None else [],
    "element_num_range_label": sorted( set( map( lambda x: "_".join( x.split("=#=")[:2] + [ "_".join( map( lambda x: x["flag"] if "sign" not in x or x["sign"] is None else x["sign"], eval(x.split("=#=")[2]) ) ) if len( eval(x.split("=#=")[2]) ) == 2 else "".join( map( lambda x: f'{x["flag"]}_None' if x["flag"] == "single" else f'{x["sign"]}_None' if "sign" in x and x["sign"] in ["upper", "upperorequal"] else f'None_{x["sign"]}' if "sign" in x and x["sign"] in ["lower", "lowerorequal"] else "None_None", eval(x.split("=#=")[2]) ) ) if len( eval(x.split("=#=")[2]) ) == 1 else "None_None" ] ) , x["构件数值属性原始预期"].split("|") ) ) ) if x["构件数值属性原始预期"] is not None else [],
    "element_num_unit_label": sorted( set( map( lambda x: "_".join( x.split("=#=")[:2] + [ "_".join( map( lambda x: "None" if len(x["unit"]) <= 0 else x["unit"].lower(), eval(x.split("=#=")[2]) ) ) if len( eval(x.split("=#=")[2]) ) == 2 else "".join( map( lambda x: "None_None" if len(x["unit"]) <= 0 else f'{x["unit"].lower()}_None' if x["flag"] == "single" or ( "sign" in x and x["sign"] in ["upper", "upperorequal"] ) else f'None_{x["unit"].lower()}' if "sign" in x and x["sign"] in ["lower", "lowerorequal"] else "None_None", eval(x.split("=#=")[2]) ) ) if len( eval(x.split("=#=")[2]) ) == 1 else "None_None" ] ) , x["构件数值属性原始预期"].split("|") ) ) ) if x["构件数值属性原始预期"] is not None else [],

    "材料_数值属性名称预期": sorted(set(map(lambda x: "_".join(x.split("=#=")[:2]), x["材料数值属性原始预期"].split("|")))) if x["材料数值属性原始预期"] is not None else [],
    "material_num_property_label": sorted(set(map(lambda x: "_".join(x.split("=#=")[:2]+[ "".join( map( lambda x: f'{round(float(x["std"])*1e4)}'.zfill(8), eval(x.split("=#=")[2]) ) )  if len( eval(x.split("=#=")[2]) ) == 2 else "".join( map( lambda x: f'{round(float(x["std"])*1e4)}'.zfill(8) + "0"*8 if x["flag"] == "single" or ( "sign" in x and x["sign"] in [ "upper", "upperorequal", ] ) else "0"*8 + f'{round(float(x["std"])*1e4)}'.zfill(8) if "sign" in x and x["sign"] in [ "lower", "lowerorequal", ] else "0"*16 , eval(x.split("=#=")[2]) ) ) if len( eval(x.split("=#=")[2]) ) == 1 else "0"*16  ] ) , x["材料数值属性原始预期"].split("|")))) if x["材料数值属性原始预期"] is not None else [],
    "material_num_range_label": sorted( set( map( lambda x: "_".join( x.split("=#=")[:2] + [ "_".join( map( lambda x: x["flag"] if "sign" not in x or x["sign"] is None else x["sign"], eval(x.split("=#=")[2]) ) ) if len( eval(x.split("=#=")[2]) ) == 2 else "".join( map( lambda x: f'{x["flag"]}_None' if x["flag"] == "single" else f'{x["sign"]}_None' if "sign" in x and x["sign"] in ["upper", "upperorequal"] else f'None_{x["sign"]}' if "sign" in x and x["sign"] in ["lower", "lowerorequal"] else "None_None", eval(x.split("=#=")[2]) ) ) if len( eval(x.split("=#=")[2]) ) == 1 else "None_None" ] ) , x["材料数值属性原始预期"].split("|") ) ) ) if x["材料数值属性原始预期"] is not None else [],
    "material_num_unit_label": sorted( set( map( lambda x: "_".join( x.split("=#=")[:2] + [ "_".join( map( lambda x: "None" if len(x["unit"]) <= 0 else x["unit"].lower(), eval(x.split("=#=")[2]) ) ) if len( eval(x.split("=#=")[2]) ) == 2 else "".join( map( lambda x: "None_None" if len(x["unit"]) <= 0 else f'{x["unit"].lower()}_None' if x["flag"] == "single" or ( "sign" in x and x["sign"] in ["upper", "upperorequal"] ) else f'None_{x["unit"].lower()}' if "sign" in x and x["sign"] in ["lower", "lowerorequal"] else "None_None", eval(x.split("=#=")[2]) ) ) if len( eval(x.split("=#=")[2]) ) == 1 else "None_None" ] ) , x["材料数值属性原始预期"].split("|") ) ) ) if x["材料数值属性原始预期"] is not None else [],
    }
keep_exists = True


[stage_aecloud_pricelib_write]
class = AECloudDatasetStage
dataset = price_library_property_fixed_label
domain = aecloud-test.glodon.com
domainModelCode = dcostSubcontractPrice
apiId = 340000
apiVerifyId = 714710722
request_inst_output = /home/shilei/fbpmx/aecloud_rebuild/pricelib_rebuild_${date}/stage_aecloud_pricelib_write/request_instances.json

