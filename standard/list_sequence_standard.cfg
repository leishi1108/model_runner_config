[DEFAULT]
workspace = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_${date}

[project]
actions = generate
datasets = raw_sequence_list_trans, sequence_list_fixed_label
evaluators = sequence_list_sequence_model_evaluate, sequence_list_sequence_ml_model_evaluate, sequence_list_sequence_ml_overall_predict, debug_predict
stages = sequence_list_spec_split_export, sequence_list_sequence_ml_overall_export, sequence_list_spec_split_trans_with_label_export
; stages = sequence_list_meta_data_export, sequence_list_spec_split_export, sequence_list_mergeSequence_export, sequence_list_sequence_match_export
deployers = list_sequence_model


[deployer_list_sequence_model]
class = P2PDeployerMultiHeadMultiLabelTransformersClassification
candidate_models = sequence_list_sequence_ml_model3
model_name = list_sequence_model
num_labels = 1
labels = "工序"::"加固处理,勾缝处理,涂料喷刷,磨光,打蜡,防滑处理,裱糊处理,刚性层处理,排气处理,排水处理,垫层处理,基层处理,回填,钢筋焊接,植筋,塞口处理,龙骨安装,嵌缝,吊杆安装,防腐处理,抹灰,防锈处理,隔离处理,底层处理,找平,找坡,结合处理,保温处理,防水处理,隔气处理,防护处理,面层处理,中层漆喷刷,底漆喷刷,房心回填,块料挂贴,干挂,湿挂,基层板安装"
user_name=shil-k
backup_dir=/home/shilei/fbpmx/list_sequence_standard/backup_models/list_sequence_model
trace_output_dir=/home/shilei/fbpmx/list_sequence_standard/deployer_list_sequence_model/${date}/
max_seq_length = 128
max_batch_size=32
max_batch_size_ms=32



[dataset_raw_sequence_list]
class = ReadExcelDataset
dir = /home/shilei/corpus/list_sequence/清单工序0904.xlsx


[dataset_raw_sequence_list_trans]
class = MapDataset
input = raw_sequence_list
expression = exec('import re; import uuid') or {"item_id": uuid.uuid3(uuid.NAMESPACE_DNS, str(x["filepath"]).split("/")[-1].split(".xlsx")[0] + "-" + str(x["uid"])).hex,
    "uid": str(x["uid"]),
    "pid": str(x["filepath"]).split("/")[-1].split(".xlsx")[0],
    "list_key": str(x["filepath"]).split("/")[-1].split(".xlsx")[0] + "-" + str(x["uid"]),
    "工序预期": ",".join(sorted(set(x["工序0904修改"].split("|")))) if x["工序0904修改"] is not None else "",
    }
keep_exists = True


[dataset_raw_sequence_list_dedup]
class = AccumulateDataset
input = raw_sequence_list_trans
deduplicate_by = list_key


[dataset_raw_sequence_list_rebuild]
class = ListCaptionSpecRebuildDataset
input = raw_sequence_list_dedup
caption_key = caption
spec_key = spec
caption_keywords = 项目名称
spec_keywords = 项目特征
sep_keywords = 项目特征,工作内容,工程内容


[stage_sequence_list_meta_data_export]
class = DatasetExportStage
dataset = raw_sequence_list_rebuild
output_fields = pid, uid, list_key, project_node_name, full_name, caption, spec, caption_rebuild, spec_rebuild
output_names = 工程id, uid, 清单id, 工程名称, 上级名称, caption, spec, caption_rebuild, spec_rebuild
save_res_path = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_${date}/sequence_list_meta_data_export_${date}.xlsx


[dataset_sequence_list_spec_split]
class = ListSpecSplitDataset
input = raw_sequence_list_rebuild
spec_key = spec_rebuild


[dataset_sequence_list_spec_split_trans]
class = MapDataset
input = sequence_list_spec_split
expression = exec('import re; import uuid') or {
    "split_id": uuid.uuid3(uuid.NAMESPACE_DNS, str(x["filepath"]).split("/")[-1].split(".xlsx")[0] + "-" + str(x["uid"]) + str(x["spec_rebuild_split"])).hex,

    "split_name": str(x["spec_rebuild_split"]) if x["spec_rebuild_split"] is not None else "",
    "item_name": str(x["caption_rebuild"]) if x["caption_rebuild"] is not None else "",
    "item_feature": str(x["spec_rebuild"]) if x["spec_rebuild"] is not None else "",
    "upper_item_name": str(x["full_name"]) if x["full_name"] is not None else "",

    "split_name_wk": f'特征分句: {x["spec_rebuild_split"]}' if x["spec_rebuild_split"] is not None else "",
    "item_name_wk": f'清单名称: {x["caption_rebuild"]}' if x["caption_rebuild"] is not None else "",
    "item_feature_wk": f'清单特征: {x["spec_rebuild"]}' if x["spec_rebuild"] is not None else "",
    "upper_item_name_wk": f'全路径: {x["full_name"]}' if x["full_name"] is not None else "",
    }
keep_exists = True


[stage_sequence_list_spec_split_export]
class = DatasetExportStage
dataset = sequence_list_spec_split_trans
output_fields = pid, uid, list_key, project_node_name, full_name, caption, spec, caption_rebuild, spec_rebuild, split_id, spec_rebuild_split
output_names = 工程id, uid, 清单id, 工程名称, 上级名称, caption, spec, caption_rebuild, spec_rebuild, split_id, spec_rebuild_split
save_res_path = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_${date}/sequence_list_spec_split_export_${date}.xlsx


############################## 修改标注 ####################################


[dataset_sequence_list_spec_split_sequence_fixed]
class = ReadExcelDataset
dir = /home/shilei/corpus/list_sequence/清单工序_标准校核.xlsx
header_row = 0


[dataset_sequence_fixed]
class = MapDataset
input = sequence_list_spec_split_sequence_fixed
expression = {"split_id": x["split_id"],
    "工序预期修改": "" if x["工序预期"] == "无工序" else None if x["工序预期"] is None else ",".join(sorted(set(x["工序预期"].split(","))))
    }


[dataset_sequence_list_mergeSequenceFixed]
class = MergeIntoDataset
base_dataset = sequence_list_spec_split_trans
merge_datasets = sequence_fixed
merge_type = only_replace
merge_key = split_id
merge_values = 工序预期修改
reset = False


[dataset_sequence_list_mergeSequenceFixed_valid]
class = FilterDataset
input = sequence_list_mergeSequenceFixed
filters = x["工序预期修改"] is not None


[dataset_sequence_list_fixed_label]
class = MapDataset
input = sequence_list_mergeSequenceFixed_valid
expression = {
    "sequence_label": list(sorted(x["工序预期修改"].split(","))) if "工序预期修改" in x and x["工序预期修改"] is not None and len(x["工序预期修改"])>0 else [],
    }
keep_exists = True


################# ce模型训练  ##############

[dataset_sequence_list_sequence_train]
class = FilterDataset
input = sequence_list_fixed_label
filters = int(x["item_id"][-5:],16) % 10 >= 2

[dataset_sequence_list_sequence_test]
class = FilterDataset
input = sequence_list_fixed_label
filters = int(x["item_id"][-5:],16) % 10 < 2


[model_sequence_list_sequence_model]
class = MultiHeadClassificationModelV2
data = sequence_list_sequence_train
bert_base = /home/shilei/model_repository/chinese-roberta-wwm-ext_ft
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 2.0e-5
num_epochs = 200
train_ratio = 0.85
batch_size = 256
max_seq_length = 128
re_predict = True


[model_sequence_list_sequence_model2]
class = MultiHeadClassificationModelV2
data = sequence_list_sequence_train
bert_base = /home/shilei/model_repository/chinese-roberta-wwm-ext_ft
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 2.0e-5
num_epochs = 200
train_ratio = 0.85
batch_size = 256
max_seq_length = 128
re_predict = True


[model_sequence_list_sequence_model3]
class = MultiHeadClassificationModelV2
data = sequence_list_sequence_train
bert_base = /home/shilei/model_repository/chinese-roberta-wwm-ext_ft
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 5.0e-5
num_epochs = 200
train_ratio = 0.85
batch_size = 256
max_seq_length = 128
re_predict = True


[model_sequence_list_sequence_model4]
class = MultiHeadClassificationModelV2
data = sequence_list_sequence_train
bert_base = /home/shilei/model_repository/chinese-roberta-wwm-ext_ft
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 5.0e-5
num_epochs = 200
train_ratio = 0.85
batch_size = 256
max_seq_length = 128
re_predict = True


[model_sequence_list_sequence_model5]
class = MultiHeadClassificationModelV2
data = sequence_list_sequence_train
bert_base = /home/shilei/model_repository/chinese-roberta-wwm-ext_ft
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 2.0e-5
num_epochs = 200
train_ratio = 0.85
batch_size = 128
max_seq_length = 128
re_predict = True


[model_sequence_list_sequence_model6]
class = MultiHeadClassificationModelV2
data = sequence_list_sequence_train
bert_base = /home/shilei/model_repository/chinese-roberta-wwm-ext_ft
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 2.0e-5
num_epochs = 200
train_ratio = 0.85
batch_size = 128
max_seq_length = 128
re_predict = True


[model_sequence_list_sequence_model7]
class = MultiHeadClassificationModelV2
data = sequence_list_sequence_train
bert_base = /home/shilei/model_repository/chinese-roberta-wwm-ext_ft
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 5.0e-5
num_epochs = 200
train_ratio = 0.85
batch_size = 128
max_seq_length = 128
re_predict = True


[model_sequence_list_sequence_model8]
class = MultiHeadClassificationModelV2
data = sequence_list_sequence_train
bert_base = /home/shilei/model_repository/chinese-roberta-wwm-ext_ft
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 5.0e-5
num_epochs = 200
train_ratio = 0.85
batch_size = 128
max_seq_length = 128
re_predict = True



[model_sequence_list_sequence_value_model]
class = CalculateModel
models = sequence_list_sequence_model
expression = sequence_list_sequence_model["工序"]
re_predict = True

[model_sequence_list_sequence_value_model2]
class = CalculateModel
models = sequence_list_sequence_model2
expression = sequence_list_sequence_model2["工序"]
re_predict = True

[model_sequence_list_sequence_value_model3]
class = CalculateModel
models = sequence_list_sequence_model3
expression = sequence_list_sequence_model3["工序"]
re_predict = True

[model_sequence_list_sequence_value_model4]
class = CalculateModel
models = sequence_list_sequence_model4
expression = sequence_list_sequence_model4["工序"]
re_predict = True

[model_sequence_list_sequence_value_model5]
class = CalculateModel
models = sequence_list_sequence_model5
expression = sequence_list_sequence_model5["工序"]
re_predict = True

[model_sequence_list_sequence_value_model6]
class = CalculateModel
models = sequence_list_sequence_model6
expression = sequence_list_sequence_model6["工序"]
re_predict = True

[model_sequence_list_sequence_value_model7]
class = CalculateModel
models = sequence_list_sequence_model7
expression = sequence_list_sequence_model7["工序"]
re_predict = True

[model_sequence_list_sequence_value_model8]
class = CalculateModel
models = sequence_list_sequence_model8
expression = sequence_list_sequence_model8["工序"]
re_predict = True


[evaluator_sequence_list_sequence_model_evaluate]
class= MultiLabelClassificationTBEvaluator
dataset = sequence_list_sequence_test
models = sequence_list_sequence_value_model,sequence_list_sequence_value_model2,sequence_list_sequence_value_model3,sequence_list_sequence_value_model4,sequence_list_sequence_value_model5,sequence_list_sequence_value_model6,sequence_list_sequence_value_model7,sequence_list_sequence_value_model8
categories = 加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装
categories_delimeter = |
label_key = sequence_label
save_res_path = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_${date}/sequence_list_sequence_model_evaluate_${date}.xlsx

################# bce二次微调  ##############

[model_sequence_list_sequence_ml_model]
class = MultiHeadMultiLabelClassificationModel
data = sequence_list_sequence_train
bert_base = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_20251224/model_sequence_list_sequence_model4/model
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 2.0e-5
num_epochs = 300
train_ratio = 0.85
batch_size = 128
max_seq_length = 128
use_focalloss = True
focalloss_alpha = "[0.1, 1]"
focalloss_gamma = 2
re_predict = False


[model_sequence_list_sequence_ml_model2]
class = MultiHeadMultiLabelClassificationModel
data = sequence_list_sequence_train
bert_base = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_20251224/model_sequence_list_sequence_model4/model
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 2.0e-5
num_epochs = 300
train_ratio = 0.85
batch_size = 128
max_seq_length = 128
use_focalloss = True
focalloss_alpha = "[0.1, 1]"
focalloss_gamma = 2
re_predict = False


[model_sequence_list_sequence_ml_model3]
class = MultiHeadMultiLabelClassificationModel
data = sequence_list_sequence_train
bert_base = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_20251224/model_sequence_list_sequence_model4/model
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 2.0e-5
num_epochs = 300
train_ratio = 0.85
batch_size = 128
max_seq_length = 128
use_focalloss = True
focalloss_alpha = "[1, 50]"
focalloss_gamma = 2
re_predict = True

[model_sequence_list_sequence_ml_model4]
class = MultiHeadMultiLabelClassificationModel
data = sequence_list_sequence_train
bert_base = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_20251224/model_sequence_list_sequence_model4/model
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 2.0e-5
num_epochs = 300
train_ratio = 0.85
batch_size = 128
max_seq_length = 128
use_focalloss = True
focalloss_alpha = "[1, 50]"
focalloss_gamma = 2
re_predict = False

[model_sequence_list_sequence_ml_model5]
class = MultiHeadMultiLabelClassificationModel
data = sequence_list_sequence_train
bert_base = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_20251224/model_sequence_list_sequence_model4/model
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 5.0e-5
num_epochs = 300
train_ratio = 0.85
batch_size = 128
max_seq_length = 128
use_focalloss = True
focalloss_alpha = "[1, 50]"
focalloss_gamma = 2
re_predict = False

[model_sequence_list_sequence_ml_model6]
class = MultiHeadMultiLabelClassificationModel
data = sequence_list_sequence_train
bert_base = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_20251224/model_sequence_list_sequence_model4/model
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 5.0e-5
num_epochs = 300
train_ratio = 0.85
batch_size = 128
max_seq_length = 128
use_focalloss = True
focalloss_alpha = "[1, 50]"
focalloss_gamma = 2
re_predict = False

[model_sequence_list_sequence_ml_model7]
class = MultiHeadMultiLabelClassificationModel
data = sequence_list_sequence_train
bert_base = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_20251224/model_sequence_list_sequence_model4/model
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 2.0e-5
num_epochs = 300
train_ratio = 0.85
batch_size = 256
max_seq_length = 128
use_focalloss = True
focalloss_alpha = "[1, 50]"
focalloss_gamma = 2
re_predict = False

[model_sequence_list_sequence_ml_model8]
class = MultiHeadMultiLabelClassificationModel
data = sequence_list_sequence_train
bert_base = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_20251224/model_sequence_list_sequence_model4/model
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 2.0e-5
num_epochs = 300
train_ratio = 0.85
batch_size = 256
max_seq_length = 128
use_focalloss = True
focalloss_alpha = "[1, 50]"
focalloss_gamma = 2
re_predict = False

[model_sequence_list_sequence_ml_model9]
class = MultiHeadMultiLabelClassificationModel
data = sequence_list_sequence_train
bert_base = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_20251224/model_sequence_list_sequence_model4/model
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 5.0e-5
num_epochs = 300
train_ratio = 0.85
batch_size = 256
max_seq_length = 128
use_focalloss = True
focalloss_alpha = "[1, 50]"
focalloss_gamma = 2
re_predict = False

[model_sequence_list_sequence_ml_model10]
class = MultiHeadMultiLabelClassificationModel
data = sequence_list_sequence_train
bert_base = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_20251224/model_sequence_list_sequence_model4/model
text_key = split_name_wk
extra_feats = upper_item_name_wk, item_name_wk, item_feature_wk
labels_delimeter = |
label_key = "工序": "sequence_label"
labels = "工序"::"加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装"
num_labels = 1
learning_rate = 5.0e-5
num_epochs = 300
train_ratio = 0.85
batch_size = 256
max_seq_length = 128
use_focalloss = True
focalloss_alpha = "[1, 50]"
focalloss_gamma = 2
re_predict = False


[model_sequence_list_sequence_value_ml_model]
class = CalculateModel
models = sequence_list_sequence_ml_model
expression = sequence_list_sequence_ml_model["工序"]
re_predict = False

[model_sequence_list_sequence_value_ml_model2]
class = CalculateModel
models = sequence_list_sequence_ml_model2
expression = sequence_list_sequence_ml_model2["工序"]
re_predict = False

[model_sequence_list_sequence_value_ml_model3]
class = CalculateModel
models = sequence_list_sequence_ml_model3
expression = sequence_list_sequence_ml_model3["工序"]
re_predict = True

[model_sequence_list_sequence_value_ml_model4]
class = CalculateModel
models = sequence_list_sequence_ml_model4
expression = sequence_list_sequence_ml_model4["工序"]
re_predict = False

[model_sequence_list_sequence_value_ml_model5]
class = CalculateModel
models = sequence_list_sequence_ml_model5
expression = sequence_list_sequence_ml_model5["工序"]
re_predict = False

[model_sequence_list_sequence_value_ml_model6]
class = CalculateModel
models = sequence_list_sequence_ml_model6
expression = sequence_list_sequence_ml_model6["工序"]
re_predict = False

[model_sequence_list_sequence_value_ml_model7]
class = CalculateModel
models = sequence_list_sequence_ml_model7
expression = sequence_list_sequence_ml_model7["工序"]
re_predict = False

[model_sequence_list_sequence_value_ml_model8]
class = CalculateModel
models = sequence_list_sequence_ml_model8
expression = sequence_list_sequence_ml_model8["工序"]
re_predict = False

[model_sequence_list_sequence_value_ml_model9]
class = CalculateModel
models = sequence_list_sequence_ml_model9
expression = sequence_list_sequence_ml_model9["工序"]
re_predict = False

[model_sequence_list_sequence_value_ml_model10]
class = CalculateModel
models = sequence_list_sequence_ml_model10
expression = sequence_list_sequence_ml_model10["工序"]
re_predict = False


[evaluator_sequence_list_sequence_ml_model_evaluate]
class= MultiLabelClassificationTBEvaluator
dataset = sequence_list_sequence_test
models = sequence_list_sequence_value_ml_model,sequence_list_sequence_value_ml_model2,sequence_list_sequence_value_ml_model3,sequence_list_sequence_value_ml_model4,sequence_list_sequence_value_ml_model5,sequence_list_sequence_value_ml_model6,sequence_list_sequence_value_ml_model7,sequence_list_sequence_value_ml_model8,sequence_list_sequence_value_ml_model9,sequence_list_sequence_value_ml_model10
categories = 加固处理|勾缝处理|涂料喷刷|磨光|打蜡|防滑处理|裱糊处理|刚性层处理|排气处理|排水处理|垫层处理|基层处理|回填|钢筋焊接|植筋|塞口处理|龙骨安装|嵌缝|吊杆安装|防腐处理|抹灰|防锈处理|隔离处理|底层处理|找平|找坡|结合处理|保温处理|防水处理|隔气处理|防护处理|面层处理|中层漆喷刷|底漆喷刷|房心回填|块料挂贴|干挂|湿挂|基层板安装
categories_delimeter = |
label_key = sequence_label
save_res_path = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_${date}/sequence_list_sequence_ml_model_evaluate_${date}.xlsx




############### 完整数据集评估 #################

[model_tjqd2]
class = GDETJQD2ServiceModel
task_type = 清单
item_name_key = item_name
item_feature_key = split_name
upper_item_name_key = upper_item_name
project_name_key = project_node_name
need_fields = item_name,split_name,upper_item_name,project_node_name


[model_gde_pricelib]
class = GDEPriceLibServiceModel
task_type = 清单
item_name_key = item_name
item_feature_key = split_name
upper_item_name_key = upper_item_name
need_fields = item_name, split_name, upper_item_name


[model_gde_sequence_material_split]
class = GDESequenceMaterialSplitServiceModel
task_type = 清单
item_name_key = item_name
item_feature_key = item_feature
item_feature_split_key = split_name
item_feature_split_id_key = split_id
upper_item_name_key = upper_item_name
need_fields = item_name, item_feature, split_name, split_id, upper_item_name
re_predict = True

[evaluator_sequence_list_sequence_ml_overall_predict]
class = SimplePredictor
datasets = sequence_list_fixed_label, sequence_list_spec_split_trans
models = sequence_list_sequence_ml_model3, tjqd2, gde_pricelib, gde_sequence_material_split
num_workers = 1


[dataset_sequence_list_sequence_ml_overall_for_export]
class = MapDataset
input = sequence_list_fixed_label
expression = exec('import re; import uuid') or {
    "工序预期": ",".join(sorted(x["sequence_label"])) if x["sequence_label"] is not None and len(x["sequence_label"]) > 0 else "",
    "模型工序": ",".join(sorted( [k for k, v in x["sequence_list_sequence_ml_model3_score"]["工序"].items() if float(v)>=0.66] )),
    "清单材料": ",".join(sorted(x["tjqd2_score"]["material"])) if x["tjqd2_score"] is not None else "",
    "指导价材料": ",".join(sorted(x["gde_pricelib_score"]["material"])) if x["gde_pricelib_score"] is not None else "",
    }
extra_dependencies = evaluator_sequence_list_sequence_ml_overall_predict
keep_exists = True



[stage_sequence_list_sequence_ml_overall_export]
class = DatasetValStage
dataset = sequence_list_sequence_ml_overall_for_export
output_fields = pid, uid, list_key, project_node_name, full_name, caption, spec, caption_rebuild, spec_rebuild, split_id, spec_rebuild_split, 工序预期, 模型工序, 清单材料, 指导价材料
output_names = 工程id, uid, 清单id, 工程名称, 上级名称, caption, spec, caption_rebuild, spec_rebuild, split_id, spec_rebuild_split, 工序预期, 模型工序, 清单材料, 指导价材料
save_res_path = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_${date}/sequence_list_sequence_ml_overall_export_${date}.xlsx
map_dict = {"模型工序":"工序预期"}

############################################################


[dataset_sequence_list_spec_split_trans_with_label_for_export]
class = MapDataset
input = sequence_list_spec_split_trans
expression = exec('import re; import uuid') or {
    "模型工序": ",".join(sorted( [k for k, v in x["sequence_list_sequence_ml_model3_score"]["工序"].items() if float(v)>=0.66] )),
    "清单材料": ",".join(sorted(x["tjqd2_score"]["material"])) if x["tjqd2_score"] is not None else "",
    "指导价材料": ",".join(sorted(x["gde_pricelib_score"]["material"])) if x["gde_pricelib_score"] is not None else "",

    "清单工序": ",".join(sorted(x["gde_sequence_material_split_score"]["sequence"])) if x["gde_sequence_material_split_score"] is not None else "",
    "清单工序材料": ",".join(sorted(x["gde_sequence_material_split_score"]["material"])) if x["gde_sequence_material_split_score"] is not None else "",
    "清单工序材料属性": ",".join(sorted( [ f'{k}_{sub_v["std"]}' for prop in x["gde_sequence_material_split_score"]["material_property"] for k, v in prop.items() if k in ["砂浆_供应状态", "水泥_品种", "水泥_强度等级", "水泥_包装形式", "水泥_掺合料技术特征", "水泥_颜色", "水泥_自应力等级", "饰面层板_面层品类", "饰面层板_树种", "饰面层板_环保等级", "装饰板_性能", "装饰板_面层结构", "装饰线条_品种", "装饰线条_表面处理", "装饰线条_使用部位", "照明灯具_形状", "照明灯具_应用场所", "照明灯具_照明方式", "照明灯具_作用", "照明灯具_安装方式", "外加剂类_应用载体", "泵_功能类型", "泵_形式", "泵_特性", "泵_动力来源", "水泥砂浆_品种", "水泥砂浆_强度等级", "水泥砂浆_技术特征", "水泥砂浆_配合比", "水泥砂浆_用途", "水泥砂浆_包装形式", "水泥砂浆_砂子级配", "水泥砂浆_包装规格", "水泥砂浆_凝结时间", "水泥砂浆_使用部位", "水泥砂浆_供应方式(是否预拌)", "水泥砂浆_特种砂浆(是否为特种砂浆)", "石灰砂浆_强度等级", "石灰砂浆_用途", "石灰砂浆_骨料成分", "石灰砂浆_技术特征", "石灰砂浆_包装形式", "石灰砂浆_砂子级配", "石灰砂浆_供应状态", "石灰砂浆_配合比", "石灰砂浆_使用部位", "石灰砂浆_供应方式(是否预拌)", "混合砂浆_用途", "混合砂浆_强度等级", "混合砂浆_骨料成分", "混合砂浆_供应状态", "混合砂浆_配合比", "混合砂浆_包装形式", "混合砂浆_供应方式(是否预拌)", "混合砂浆_使用部位", "灰土垫层材料_配合比", "多合土垫层_品种", "多合土垫层_配合比", "水泥浆料_骨料成分", "水泥浆料_配合比", "水泥浆料_强度等级", "水泥浆料_品种", "水泥浆料_掺合料技术特征", "水泥浆料_颜色", "堵漏灌浆材料_包装方式", "堵漏灌浆材料_强度等级", "堵漏灌浆材料_灌浆料分型", "堵漏灌浆材料_组份", "堵漏灌浆材料_适用范围", "堵漏灌浆材料_材质", "堵漏灌浆材料_特性", "普通混凝土_强度等级", "普通混凝土_抗渗等级", "普通混凝土_粗集料最大粒径", "普通混凝土_砂子级配", "普通混凝土_泵送类型", "普通混凝土_抗冻等级", "普通混凝土_供应方式(是否现拌)", "普通混凝土_是否泵送", "普通混凝土_外加剂(膨胀型)", "普通混凝土_外加剂(抗渗型)", "普通混凝土_外加剂(防冻型)", "普通混凝土_外加剂(减水型)", "普通混凝土_外加剂(早强型)", "普通混凝土_外加剂(缓凝型)", "普通混凝土_使用位置", "普通混凝土_外加剂(增塑型)", "普通混凝土_水泥强度", "轻骨料混凝土_骨料成分", "轻骨料混凝土_用途", "轻骨料混凝土_供应方式(是否现拌)", "轻骨料混凝土_密度等级", "轻骨料混凝土_强度等级", "轻骨料混凝土_泵送类型", "轻骨料混凝土_是否泵送", "沥青混凝土_结合料种", "沥青混凝土_粗集料规格", "沥青混凝土_型号", "沥青混凝土_性能", "沥青混凝土_泵送类型", "沥青混凝土_胶结料", "沥青混凝土_是否泵送", "特种混凝土_强度等级及配合比", "特种混凝土_粗集料成分", "特种混凝土_性能", "特种混凝土_供应方式(是否现拌)", "特种混凝土_抗冻融等级", "特种混凝土_泵送类型", "特种混凝土_外加剂(乳化剂)", "特种混凝土_外加剂(减水剂)", "特种混凝土_外加剂(压浆剂)", "特种混凝土_外加剂(固化剂)", "特种混凝土_外加剂(增塑剂)", "特种混凝土_外加剂(密实剂)", "特种混凝土_外加剂(引气剂)", "特种混凝土_外加剂(抗渗剂)", "特种混凝土_外加剂(抗裂剂)", "特种混凝土_外加剂(改性剂)", "特种混凝土_外加剂(早强剂)", "特种混凝土_外加剂(泵送剂)", "特种混凝土_外加剂(清洗剂)", "特种混凝土_外加剂(灌浆剂)", "特种混凝土_外加剂(界面剂)", "特种混凝土_外加剂(稀释剂)", "特种混凝土_外加剂(粘度改性材料)", "特种混凝土_外加剂(缓凝剂)", "特种混凝土_外加剂(膨胀剂)", "特种混凝土_外加剂(速凝剂)", "特种混凝土_外加剂(防冻剂)", "特种混凝土_外加剂(防水剂)", "特种混凝土_外加剂(防腐剂)", "特种混凝土_外加剂(防腐防霉剂)", "特种混凝土_外加剂(防锈防腐剂)", "特种混凝土_外加剂(阻锈剂)", "特种混凝土_是否泵送", "自密实混凝土_强度等级", "自密实混凝土_抗渗等级", "自密实混凝土_自密实等级", "自密实混凝土_供应方式(是否现拌)", "自密实混凝土_外加剂(增塑剂)", "自密实混凝土_泵送类型", "自密实混凝土_是否泵送", "自密实混凝土_外加剂(抗渗剂)", "自密实混凝土_外加剂(早强剂)", "自密实混凝土_外加剂(膨胀剂)", "清水混凝土_强度等级", "清水混凝土_抗渗等级", "透水混凝土_强度等级", "透水混凝土_颜色", "透水混凝土_供应方式(是否现拌)", "透水混凝土_泵送类型", "透水混凝土_透水系数", "透水混凝土_是否泵送", "纤维混凝土_泵送类型", "纤维混凝土_供应方式(是否现拌)", "纤维混凝土_抗冻等级", "纤维混凝土_抗渗等级", "纤维混凝土_强度等级", "纤维混凝土_水泥强度", "纤维混凝土_外加剂(抗渗剂)", "纤维混凝土_纤维成分", "纤维混凝土_是否泵送", "纤维混凝土_外加剂(早强剂)", "纤维混凝土_外加剂(缓凝剂)", "纤维混凝土_外加剂(膨胀剂)", "纤维混凝土_外加剂(防冻剂)", "纤维混凝土_外加剂(防水剂)", "钢筋_品种", "钢筋_牌号", "钢筋_轧机方式", "钢筋_涂层材质", "钢筋_类型", "钢筋_用途", "钢丝_工艺", "钢丝_表面处理", "钢丝_抗拉强度", "钢丝_断面形状", "钢丝_材质", "钢丝_用途", "钢丝束_品种", "钢丝束_抗拉强度", "钢丝束_表面处理", "钢丝绳_断面形状", "钢丝绳_用途", "钢丝绳_钢丝根数", "钢丝绳_绳芯", "钢丝绳_品种", "钢丝绳_股数", "钢丝绳_材质", "钢丝绳_抗拉强度", "钢绞线_品种", "钢绞线_结构", "钢绞线_抗拉强度", "钢绞线_状态", "钢绞线_用途", "钢绞线_表面涂层", "铅丝_材质", "铝合金型材_表面处理", "铝合金型材_截面形状", "铝合金型材_材质", "铝合金型材_颜色", "铝合金型材_部位", "铝合金型材_膜厚级别", "铝合金型材_供应状态", "铝合金型材_用途", "铝合金型材_性能", "不锈钢板_材质", "不锈钢板_表面处理", "不锈钢板_性能", "铝板_材质", "铝板_图案", "钢板_工艺", "钢板_表面处理", "钢板_材质", "钢板_钢材级别", "钢板_用途", "钢板_交货状态", "琉璃砖_品种", "普通瓦_品种", "普通瓦_用途", "普通瓦_表面处理", "陶土瓦_截面形状", "陶土瓦_表面处理", "陶土瓦_颜色", "彩钢瓦_截面形状", "彩钢瓦_颜色", "混凝土瓦_截面形状", "混凝土瓦_颜色", "混凝土瓦_层间结构", "砌砖_工艺", "砌砖_骨料材质", "砌砖_强度等级", "砌砖_结构形式", "砌砖_砌体颜色", "砌砖_质量等级", "砌砖_用途", "砌砖_形状", "砌块_加压工艺", "砌块_骨料材质", "砌块_结构形式", "砌块_强度等级", "砌块_砌体颜色", "砌块_质量等级", "砌块_用途", "砌块_功能特性", "砌块_加气工艺", "砌块_加砂工艺", "砌块_干密度级别", "石料_材质", "石料_产地", "砂_品种", "砂_成分", "砂_产源", "砂_目数", "砂_处理方式", "砂_包装方式", "石子_品种", "轻骨料_品种", "掺和填充料_品种", "掺和填充料_包装形式", "掺和填充料_目数", "掺和填充料_用途", "壁画_材质", "壁画_性能", "壁画_花色及图案", "壁纸_材质", "壁纸_性能", "壁纸_花色及图案", "壁布_材质", "壁布_性能", "壁布_花色及图案", "格栅、格片、挂片_品种", "格栅、格片、挂片_表面处理", "网格布、带_品种", "网格布、带_颜色", "网格布、带_网眼规格", "金、银箔制品_品种", "竹木装饰板_品种", "竹木装饰板_树种", "竹木装饰板_质量等级", "竹木装饰板_使用部位", "石膏板_表面处理", "石膏板_面层结构", "石膏板_性能", "墙砖及地砖_用途", "墙砖及地砖_使用部位", "岩板_样式", "涂料_是否有机", "木龙骨_树种", "轻钢龙骨配件_品种", "铝合金龙骨配件_品种", "铝合金龙骨配件_型号", "栏杆_材质", "栏杆_表面处理", "栏杆_使用部位", "收口条_材质", "装饰字_材质", "灯箱_面层材料", "灯箱_结构材料", "胶合板_品种", "胶合板_树种", "胶合板_强度等级", "胶合板_环保等级", "纤维板_品种", "纤维板_面板材质", "纤维板_性能", "纤维板_环保等级", "木质板材_树种", "木质板材_表面处理", "枋材_树种", "枋材_表面处理", "枋材_环保等级", "枕木_树种", "玻璃板_颜色", "玻璃板_性能", "玻璃板_工艺方法", "玻璃马赛克_品种", "玻璃马赛克_颜色", "玻璃砖_品种", "玻璃镜_品种", "玻璃镜_镀层", "玻璃镜_用途", "防雾镜_品种", "防雾镜_药筒容量", "防雾镜_功率", "钢化玻璃_性能", "钢化玻璃_颜色", "钢化玻璃_截面形状", "镀膜玻璃_颜色", "镀膜玻璃_工艺", "镀膜玻璃_性能", "烤漆玻璃_颜色", "塑料管_是否波纹管", "橡胶管_夹布层数", "复合管_内层材质", "复合管_品种", "复合管_外层材质", "复合管_中间骨架材质", "复合管_媒介", "复合管_性能", "混凝土管_接口形式", "固化剂_应用载体", "膨胀剂_成分", "膨胀剂_抗渗等级", "膨胀剂_品种", "膨胀剂_型号", "膨胀剂_应用载体", "防冻剂_成分", "防冻剂_技术特征", "防冻剂_交货状态", "防冻剂_应用载体", "减水剂_应用载体", "抗渗剂_抗渗等级", "抗渗剂_成分", "抗渗剂_应用载体", "增强剂_产源", "增强剂_成分", "增强剂_增强程度", "增强剂_增强剂成分", "增强剂_应用载体", "早强剂_成分", "早强剂_应用载体", "增色剂_应用载体", "避雷装置_材质", "避雷装置_额定电压", "避雷装置_品种", "钢檩条_类型", "储物柜_材质", "储物柜_使用性质", "储物柜_开门方式", "储物柜_柜体形式", "储物柜_用途", "屏风隔断_骨架材质", "屏风隔断_面层材质", "屏风隔断_形态", "书柜_材质", "书柜_款式", "桥梁支座_材质", "桥梁支座_承载力", "桥梁支座_剪切模量", "桥梁支座_位移型式", "桥梁支座_支座构造", "桥梁支座_支座形式", "桥梁支座_类型(标签)", "盖板_使用部位", "盖板_材质", "盖板_用途", "排水沟槽_位置", "路面砖_类别", "路面砖_使用部位", "土方_类别", "水泵_用途", "水泵_动力来源", "饮水器_品种", "饮水器_功率", "饮水器_容量", "浴缸、浴盆_材质", "浴缸、浴盆_形状", "浴缸、浴盆_功能", "浴缸、浴盆_颜色", "浴缸、浴盆_款式", "净身盆_材质", "净身盆_喷洗方式", "净身盆_水龙头孔数", "淋浴间、淋浴屏_材质", "淋浴间、淋浴屏_形状", "淋浴间、淋浴屏_龙骨材料", "淋浴间、淋浴屏_门扇开启方式", "蹲便器_材质", "蹲便器_冲水方式", "座便器_材质", "座便器_结构形式", "座便器_配件功能", "座便器_排污方式", "座便器_冲水量(L)", "小便器_品种", "小便器_结构形式", "小便器_排污方式", "小便器_功能", "小便器_冲水量(L)", "洗发盆_品种", "洗发盆_台面材质", "洗涤盆、化验盆_品种", "洗涤盆、化验盆_材质", "洗涤盆、化验盆_结构形式", "抽水缸_品种", "调压装置_品种", "调压装置_安装方式", "燃气管道专用附件_品种", "自流平料_基料", "脚手架_品种", "脚手架_结构形式", "脚手架_支固方式", "模板_模板芯材", "模板_质量等级", "模板_环保等级", "模板_用途", "模板_周转次数", "模板_所附混凝土是否抗渗", "模板_是否超高", "模壳_构造分类", "模壳_基材", "模板支撑_材质", "安全网(防尘网)_材质", "安全网(防尘网)_防火等级", "安全网(防尘网)_颜色", "钢筋网片_牌号", "预应力混凝土用钢丝_品种", "预应力混凝土用钢丝_抗拉强度", "H型钢_品种", "H型钢_工艺", "H型钢_材质", "H型钢_表面处理", "H型钢_性能", "H型钢_用途", "工字钢_工艺", "工字钢_用途", "工字钢_性能", "工字钢_材质", "工字钢_表面处理", "槽钢_工艺", "槽钢_材质", "槽钢_表面处理", "槽钢_型号", "槽钢_用途", "槽钢_性能", "方钢_工艺", "方钢_材质", "方钢_表面处理", "圆钢_工艺", "圆钢_表面处理", "圆钢_材质", "扁钢_工艺", "扁钢_材质", "扁钢_表面处理", "角钢_工艺", "角钢_材质", "角钢_表面处理", "角钢_性能", "角钢_用途", "C型钢_工艺", "C型钢_材质", "C型钢_表面处理", "C型钢_型号", "T型钢_表面处理", "T型钢_材质", "T型钢_工艺", "T型钢_品种", "T型钢_性能", "T型钢_用途", "断桥铝合金型材_表面处理", "断桥铝合金型材_截面形状", "断桥铝合金型材_部位", "断桥铝合金型材_膜厚级别", "断桥铝合金型材_颜色", "断桥铝合金型材_供应状态", "断桥铝合金型材_用途", "不锈钢装饰板_材质", "不锈钢装饰板_表面处理", "不锈钢装饰板_质量等级", "不锈钢装饰板_加工工艺", "金属烤瓷板_基层材料", "装饰铝板_品种", "装饰铝板_材质", "装饰铝板_表面处理", "装饰铝板_质量等级", "装饰铝板_加工工艺", "彩色压型钢板_用途", "彩色压型钢板_截面形状", "彩色压型钢板_表面处理", "玻镁平板_质量等级", "玻镁平板_性能", "硅酸钙装饰板_品种", "硅酸钙装饰板_性能", "纤维水泥装饰板_品种", "纤维水泥装饰板_密度分类", "纤维水泥装饰板_环保等级", "纤维水泥装饰板_性能", "纤维水泥装饰板_质量等级", "复合装饰板_板芯材质", "复合装饰板_环保等级", "复合装饰板_表面处理", "复合装饰板_质量等级", "泡沫塑料装饰吸声板_品种", "泡沫塑料装饰吸声板_环保等级", "泡沫塑料装饰吸声板_质量等级", "聚碳酸酯中空板_品种", "聚碳酸酯中空板_环保等级", "聚碳酸酯中空板_质量等级", "轻质板材_品种", "轻质板材_环保等级", "夹心轻质板材_品种", "夹心轻质板材_环保等级", "纸面石膏板_表面处理", "纸面石膏板_面层结构", "纸面石膏板_性能", "陶瓷砖_类别", "陶瓷砖_使用部位", "陶瓷砖_颜色", "陶瓷砖_表层效果", "陶瓷砖_质量等级", "马赛克_表面处理", "马赛克_颜色", "实木地板_拼接形式", "实木地板_树种", "实木地板_表面处理", "实木地板_接口形式", "复合地板_复合板基层材料", "复合地板_面层材质", "复合地板_质量等级", "复合地板_耐磨转数", "复合地板_表面处理", "塑料地板_材质", "塑料地板_环保等级", "塑料地板_拼接形式", "塑料地板_颜色", "橡胶地板_材质", "橡胶地板_性能", "橡胶地板_花色及图案", "亚麻环保地板_等级标准", "防静电地板_材质", "防静电地板_饰面层", "防静电地板_耐火等级", "地毯_材质", "地毯_产品形态", "地毯_制作方式", "地毯_功能", "地毯_纱线材质及比例", "门毡_材质", "门毡_纱线材质及比例", "门毡_制作方式", "橡胶板_材质", "橡胶板_性能", "橡胶板_物理状态", "橡胶板_颜色", "橡胶板_衬里硫化形式", "橡胶板_耐温", "橡胶条、带_材质", "橡胶条、带_用途", "橡胶条、带_性能", "橡胶条、带_颜色", "橡胶条、带_截面形状", "橡胶输送带_材质", "橡胶输送带_性能", "橡胶圈_品种", "橡胶圈_性能", "橡胶圈_截面形状", "橡胶圈_接口形式", "橡胶圈_用途", "橡胶圈_颜色", "橡胶棒_材质", "塑料板_材质", "塑料板_性能", "有机玻璃板_颜色", "有机玻璃板_性能", "有机玻璃板_工艺方法", "塑料薄膜_材质", "塑料薄膜_性能", "塑料薄膜_表面处理", "塑料薄膜_用途", "塑料薄膜_透光率", "软膜天花_防火等级", "软膜天花_颜色", "软膜天花_透光率", "软膜天花_隔热率", "软膜天花_紫外线过滤率", "软膜天花_使用部位", "塑料袋_截面形状", "塑料袋_材质", "塑料袋_颜色", "塑料袋_质量等级", "棉制品_材质", "棉制品_性能", "麻袋_原料性质", "草制品_品种", "真皮_材质", "人造革_材质", "丝制品_品种", "丝制品_颜色", "化纤制品_品种", "化纤制品_颜色", "化纤制品_原料性质", "功能性涂料_性能", "功能性涂料_成膜物质", "功能性涂料_颜色", "功能性涂料_合成组分", "功能性涂料_力学性能", "功能性涂料_使用部位", "建筑涂料_成膜物质", "建筑涂料_颜色", "建筑涂料_成膜光泽度", "建筑涂料_合成组分", "建筑涂料_性能", "建筑涂料_环保等级", "建筑涂料_使用部位", "建筑涂料_分散介质", "建筑涂料_力学性能", "建筑涂料_极限耐火时间", "古建专用油漆_成膜光泽度", "古建专用油漆_环保等级", "古建专用油漆_性能", "古建专用油漆_颜色", "专用涂料_成膜物质", "专用涂料_合成组分", "专用涂料_光泽度", "专用涂料_掺合料成份", "专用涂料_溶剂类型", "专用涂料_使用部位", "专用涂料_用途", "专用涂料_使用层次", "沥青原料_牌号", "沥青原料_用途", "沥青原料_主要成分组成", "防水卷材_品种", "防水卷材_胎基", "防水卷材_覆面材料", "防水卷材_粘结表面", "防水卷材_防火等级", "防水卷材_施工工艺", "防水卷材_材料性能", "防水卷材_合成材料", "防水卷材_类型", "防水卷材_复合层", "型钢龙骨_表面处理", "型钢龙骨_断面形状", "轻钢龙骨_表面处理", "轻钢龙骨_断面形状", "轻钢龙骨_型号", "铝合金龙骨_品种", "铝合金龙骨_断面形状", "铝合金龙骨_表面处理", "不锈钢龙骨_品种", "不锈钢龙骨_使用部位", "门_类型", "门_树种", "门_开启方式", "门_阻隔方式", "门_防火等级", "门_性能", "门_型号", "门_表面处理", "门_工艺", "门_启动方式", "门_材质", "窗_材质", "窗_性能", "窗_防火等级", "窗_开启方式", "窗_树种", "窗_阻隔方式", "窗_型号", "窗_表面处理", "窗_工艺", "窗帘_材质", "窗帘_形状", "窗帘_性能", "窗帘_防火等级", "窗纱_材质", "花岗石板材_是否带保温", "柱头_材质", "柱头_表面处理", "石柱帽_材质", "石柱帽_表面处理", "石门臼_材质", "石门臼_表面处理", "大理石_品名", "大理石_表面处理", "大理石_品质等级", "大理石_产地", "大理石_使用部位", "花岗岩_表面处理", "花岗岩_品质等级", "花岗岩_品名", "花岗岩_产地", "花岗岩_使用部位", "水磨石_表面处理", "水磨石_颜色", "铸铁管_材质", "铸铁管_接口形式", "铸铁管_内防腐层", "铸铁管_压力等级", "铸铁管_媒介", "铸铁管_加工工艺", "铸铁管_连接方式", "铝管_材质", "铝管_轧制方式", "铜管、铜合金管_材质", "铜管、铜合金管_加工方式", "金属波纹管_材质", "金属波纹管_波纹数", "矩形管_表面处理", "矩形管_材质", "HDPE高密度聚乙烯管_管体形式", "HDPE高密度聚乙烯管_接口形式", "HDPE高密度聚乙烯管_媒介", "HDPE高密度聚乙烯管_性能", "HDPE高密度聚乙烯管_是否波纹管", "PE-X交联聚乙烯管_管系", "PE-X交联聚乙烯管_接口形式", "PE-X交联聚乙烯管_是否波纹管", "PB聚丁烯管_管系", "PB聚丁烯管_接口形式", "PB聚丁烯管_是否波纹管", "PP-R三型聚丙烯管_媒介", "PP-R三型聚丙烯管_供应商", "PP-R三型聚丙烯管_是否波纹管", "UPVC硬聚氯乙烯管_管体形式", "UPVC硬聚氯乙烯管_媒介", "UPVC硬聚氯乙烯管_性能", "UPVC硬聚氯乙烯管_供应商", "UPVC硬聚氯乙烯管_机械性能", "UPVC硬聚氯乙烯管_是否波纹管", "PVC(PVC-M)软聚氯乙烯管_接口形式", "PVC(PVC-M)软聚氯乙烯管_管体形式", "PVC(PVC-M)软聚氯乙烯管_媒介", "PVC(PVC-M)软聚氯乙烯管_供应商", "PVC(PVC-M)软聚氯乙烯管_性能", "PVC(PVC-M)软聚氯乙烯管_机械性能", "PVC(PVC-M)软聚氯乙烯管_是否波纹管", "CPVC氯化聚氯乙烯管_管系", "CPVC氯化聚氯乙烯管_是否波纹管", "PE聚乙烯管_材料等级", "PE聚乙烯管_媒介", "PE聚乙烯管_是否波纹管", "AGR丙烯酸共聚聚氯乙烯管_是否波纹管", "EPE发泡聚乙烯管_是否波纹管", "铝塑复合管_媒介", "铝塑复合管_颜色", "钢骨架聚乙烯塑料复合管_媒介", "钢骨架聚乙烯塑料复合管_颜色", "玻璃钢增强复合管_刚度级SN", "钢塑复合管_适用介质", "钢塑复合管_材质", "钢塑复合管_重量", "衬塑复合管_基管", "衬塑复合管_媒介", "衬塑复合管_内衬(涂)层材质", "衬塑复合管_外涂(镀)材质", "衬塑复合管_性能", "覆(涂)塑复合管_内衬(涂)层材质", "覆(涂)塑复合管_部位", "覆(涂)塑复合管_基管", "覆(涂)塑复合管_媒介", "覆(涂)塑复合管_外涂(镀)材质", "覆(涂)塑复合管_性能", "钢筋混凝土管_接口形式", "螺栓_性能等级", "螺栓_表面处理", "螺栓_结构形式", "螺栓_附件", "螺栓_性能", "螺栓_品种", "螺栓_材质", "螺栓_用途", "保温钉_材质", "铁丝_表面处理", "铁丝_焊接方式", "钢筋套筒_连接形式", "钢筋套筒_加工工艺", "钢筋套筒_材质", "钢筋套筒_牌号", "钢筋锚具_结构形式", "钢筋锚具_品种", "钢筋锚具_钢筋根数", "钢筋保护帽_材质", "雨水口_砌筑方式", "钢筋笼_适用范围", "钢筋笼_用途", "金属压板_型钢种类", "钢筋支架_材质", "钢筋混凝土预制墙_使用部位", "钢筋混凝土预制墙_保温", "钢筋混凝土预制墙_保温(填充)层材质", "钢筋混凝土预制墙_构造特征", "钢筋混凝土预制墙_结构特征", "钢筋混凝土预制墙_内页墙", "钢筋混凝土预制墙_强度等级", "钢筋混凝土预制墙_饰面层材料", "钢筋混凝土预制墙_外页墙", "钢筋混凝土预制墙_是否保温", "钢筋混凝土预制墙_形状", "预制钢筋混凝土桩_类型", "预制钢筋混凝土桩_是否空心", "预制钢筋混凝土桩_施工工艺", "空调器_安装方式", "散流器_品种", "散流器_材质", "散流器_风量", "散流器_叶片层数", "风口_材质", "风管_材质", "风管_连接方式", "风管_防火等级", "风管_性能", "风管_品种", "风管_结构特性", "挡烟垂壁_控制方式", "风机_气体流动方向", "风机_出口压力", "脚手架扣件_扣件形式", "脚手架扣件_工艺", "脚手架扣件_材质", "脚手架钢管_材质", "脚手架钢管_结构形式", "脚手架钢管_用途", "脚手架钢管_表面处理", "U型钢板桩_工艺", "U型钢板桩_材质", "U型钢板桩_表面处理", "U型钢板桩_型号", "Z型钢板桩_工艺", "Z型钢板桩_材质", "Z型钢板桩_表面处理", "Z型钢板桩_性能", "Z型钢板桩_用途", "塑料天花板_品种", "塑料天花板_环保等级", "塑料天花板_质量等级", "塑料装饰扣板_品种", "塑料装饰扣板_环保等级", "塑料装饰扣板_质量等级", "聚氨酯纤维吸音板_品种", "聚氨酯纤维吸音板_环保等级", "聚氨酯纤维吸音板_质量等级", "水泥珍珠岩保温板_防火等级", "珍珠岩粉_粒度", "蛭石散材_包装规格", "蛭石散材_产地", "膨胀珍珠岩_包装规格", "膨胀珍珠岩_产地", "石棉管壳_使用温度", "矿棉管壳_阻燃等级", "岩棉管壳_等级", "岩棉管壳_容重", "油漆_使用部位", "油漆_性能", "防水剂_用途", "止水带_材质", "止水带_安装方式", "止水螺杆_材质", "密封材料_固化机理", "密封材料_合成材料", "密封材料_品种", "密封材料_使用部位", "密封材料_颜色", "防水毯、板_材质", "止水材料_安装方式", "止水材料_材质", "止水材料_品种", "js防水涂料_性能", "焊接钢管_材质", "焊接钢管_焊缝形状", "焊接钢管_焊接方式", "镀锌钢管_材质", "镀锌钢管_镀锌方式", "不锈钢管_材质", "不锈钢管_表面状态", "不锈钢管_品种", "不锈钢管_壁厚等级", "不锈钢管_焊接形式", "不锈钢管_焊缝形式", "不锈钢管_管材精度", "无缝钢管_材质", "无缝钢管_工艺", "无缝钢管_表面处理", "无缝钢管_适用介质", "异形钢管_材质", "异形钢管_牌号", "异形钢管_工艺", "热镀锌方矩管_材质", "热镀锌方矩管_表面处理", "不锈钢方矩管_材质", "不锈钢方矩管_表面状态", "碳钢方矩管_材质", "碳钢方矩管_焊缝形状", "碳钢方矩管_焊接方式", "FPPR玻纤增强聚丙烯管_媒介", "FPPR玻纤增强聚丙烯管_供应商", "FPPR玻纤增强聚丙烯管_是否波纹管", "PVC纤维增强软管_是否波纹管", "PVC钢丝增强管_是否波纹管", "PVC七孔梅花管_是否波纹管", "膨胀螺栓_表面处理", "膨胀螺栓_材质", "膨胀螺栓_结构形式", "膨胀螺栓_强度等级", "花篮螺栓_螺旋扣形式", "花篮螺栓_强度等级", "地脚螺栓_表面处理", "地脚螺栓_材质", "地脚螺栓_附件", "地脚螺栓_结构形式", "洁具排水附件_使用部位", "混凝土屋面板_混凝土类型", "混凝土屋面板_强度等级", "预制混凝土桩接头_适用桩型", "无纺布_材质", "聚苯乙烯泡沫板EPS_防火等级", "挤塑聚苯乙烯泡沫板XPS_防火等级", "聚乙烯泡沫塑料板PEF_防火等级", "酚醛泡沫塑料板PE_防火等级", "聚氨酯泡沫塑料板PUR_防火等级", "脲醛泡沫塑料板UF_防火等级", "岩棉板_网架材质", "岩棉板_等级", "岩棉板_性能", "岩棉板_面层材质", "石棉水泥板_使用温度", "石棉水泥板_颜色", "石棉水泥板_性能", "玻璃棉板(毡)_阻燃等级", "玻璃棉板(毡)_容重", "玻璃棉板(毡)_面层材质", "复合岩棉板_网架材质", "复合岩棉板_等级", "止水钢板_材质", "止水钢板_表面处理", "洁具排水接头_使用部位", "防水涂料_品种", "防水涂料_组分", "防水涂料_性能", "防水涂料_特性是否非固化型", ] for sub_v in v  ] )) if "gde_sequence_material_split_score" in x and "material_property" in x["gde_sequence_material_split_score"] and x["gde_sequence_material_split_score"]["material_property"] is not None else "",
    }
extra_dependencies = evaluator_sequence_list_sequence_ml_overall_predict
keep_exists = True


[stage_sequence_list_spec_split_trans_with_label_export]
class = DatasetExportStage
dataset = sequence_list_spec_split_trans_with_label_for_export
output_fields = pid, uid, list_key, project_node_name, full_name, caption, spec, caption_rebuild, spec_rebuild, split_id, spec_rebuild_split, 模型工序, 清单材料, 指导价材料, 清单工序, 清单工序材料, 清单工序材料属性
output_names = 工程id, uid, 清单id, 工程名称, 上级名称, caption, spec, caption_rebuild, spec_rebuild, split_id, spec_rebuild_split, 模型工序, 清单材料, 指导价材料, 清单工序, 清单工序材料, 清单工序材料属性
save_res_path = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_${date}/sequence_list_spec_split_trans_with_label_export_${date}.xlsx

######################### 不一致debug ############################


[dataset_unsame_debug]
class = FilterDataset
input = sequence_list_spec_split_trans
filters = x["split_id"] in ["dc7eff04c61f3e688c087035dfba6fbe", ]


[evaluator_debug_predict]
class = SimplePredictor
datasets = unsame_debug
models = sequence_list_sequence_ml_model3, gde_sequence_material_split
num_workers = 2


################# 工序预期整理  ##############

[dataset_raw_sequence]
class = MapDataset
input = raw_sequence_list_trans
expression = {"list_key": x["list_key"], "工序预期": x["工序预期"]}

[dataset_raw_sequence_grouped]
class = GroupedDataset
input = raw_sequence
groupby = list_key
value_key = 工序预期


[dataset_sequence_list_mergeSequence]
class = MergeIntoDataset
base_dataset = sequence_list_spec_split
merge_datasets = raw_sequence_grouped
merge_type = only_replace
merge_key = list_key
merge_values = 工序预期
reset = False

[stage_sequence_list_mergeSequence_export]
class = DatasetExportStage
dataset = sequence_list_mergeSequence
output_fields = pid, uid, list_key, project_node_name, full_name, caption, spec, caption_rebuild, spec_rebuild, spec_rebuild_split, 工序预期
output_names = 工程id, uid, 清单id, 工程名称, 上级名称, caption, spec, caption_rebuild, spec_rebuild, spec_rebuild_split, 工序预期
save_res_path = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_${date}/sequence_list_mergeSequence_export_${date}.xlsx






################# 大模型预标注  ##############

[model_remote_sequence_match_model]
class = SequenceMatchModel
url = http://10.0.79.55:9002
input_text_key = spec_rebuild_split
need_fields = spec_rebuild_split


[evaluator_sequence_list_spec_split_sequence_match]
class = SimplePredictor
datasets = sequence_list_mergeSequence
models = remote_sequence_match_model
num_workers = 1



[dataset_sequence_list_sequence_match_for_export]
class = MapDataset
input = sequence_list_mergeSequence
expression = exec('import re; import uuid') or {
    "匹配工序": x["remote_sequence_match_model_score"]["json_output"]["ai_message"] if "ai_message" in x["remote_sequence_match_model_score"]["json_output"] else "",
    }
keep_exists = True
extra_dependencies = evaluator_sequence_list_spec_split_sequence_match



[stage_sequence_list_sequence_match_export]
class = DatasetExportStage
dataset = sequence_list_sequence_match_for_export
output_fields = pid, uid, list_key, project_node_name, full_name, caption, spec, caption_rebuild, spec_rebuild, spec_rebuild_split, 工序预期, 匹配工序
output_names = 工程id, uid, 清单id, 工程名称, 上级名称, caption, spec, caption_rebuild, spec_rebuild, spec_rebuild_split, 工序预期, 匹配工序
save_res_path = /home/shilei/fbpmx/list_sequence_standard/list_sequence_standard_${date}/sequence_list_sequence_match_export_${date}.xlsx


############################################################



