[DEFAULT]
workspace = /home/shilei/fbpmx/list_cost_relation/list_cost_relation_${date}


[project]
actions = generate, train

[models]
keys = trained

[datasets]
keys = project_list_cost_out, label_studio_data, positive, negative


[dataset_label_studio_data]
class = LabelStudioDataset
project_ids = 58,59
reset = False


[dataset_project_list_cost_out]
class = ReadFileDataset
format = json
dir = /home/shilei/corpus/list_cost_relation/project_list_cost_out.json
reset = False


[dataset_project_list_cost_trans]
class = MapDataset
input = project_list_cost_out
expression = exec('import uuid') or {'relation_id': uuid.uuid4().hex, 'label': int(x["label"])}
keep_exists = True
reset = False



[dataset_positive]
class = FilterDataset
input = project_list_cost_trans
filters = ("label" in x) and (x["label"] == 1)
reset = False


[dataset_negative]
class = FilterDataset
input = project_list_cost_trans
filters = ("label" in x) and (x["label"] == 0) and ( ( int(x["pid_list_map_cost_negative"])<10000 ) or (int(x["pid_list_map_cost_negative"])>=10000) and (int(x["relation_id"][-5:],16) % 10 < 1))
reset = False


[dataset_trained]
class = MergeDataset
datasets = positive, negative

[model_trained]
class = BinaryClassificationModel
data = trained
bert_base = /home/shilei/model_repository/chinese-roberta-wwm-ext_ft
text=list_name
with_context=1
context=cost_name
learning_rate = 2.0e-5
num_epochs = 70
train_ratio = 0.85
batch_size = 128
max_seq_length = 128
positive = 1
negative = 0


