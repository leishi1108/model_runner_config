[DEFAULT]
workspace = /home/shilei/fbpmx/list_extract/pricelib_property_${date}

[project]
actions = generate, run
datasets = raw_price_library_property_dedup, raw_price_library_element_property, raw_price_library_element_enum_property, raw_price_library_element_num_property
stages = raw_price_library_element_enum_property_export, raw_price_library_element_num_property_export

[dataset_raw_price_library_property]
class = ReadExcelLackKeyDataset
key_cols = uid
feature_cols = costPartial, element, material, sequence
dir = /home/shilei/corpus/cost_split/分包指导价属性/05-中交一公局北京建筑-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/08-一冶-土建-解析预期结果(工程数据分包指导价).xlsx

[dataset_raw_price_library_property_trans]
class = MapDataset
input = raw_price_library_property
expression = exec('import re; import uuid') or {"item_id": uuid.uuid3(uuid.NAMESPACE_DNS, str(x["filepath"]).split("/")[-1].split("-解析预期结果")[0] + "-" + str(x["uid"])).hex,
    "uid": str(x["uid"]),
    "list_key": str(x["filepath"]).split("/")[-1].split("-解析预期结果")[0] + "-" + str(x["uid"]),
    "item_name": x["名称"],
    "item_feature": x["项目特征"],
    "upper_item_name": x["分部全路径"],
    "pid": str(x["filepath"]).split("/")[-1].split("-解析预期结果")[0],
    "item_name_wk": f'清单名称: {x["名称"]}' if x["名称"] is not None else "",
    "item_feature_wk": f'清单特征: {x["项目特征"]}' if x["项目特征"] is not None else "",
    "upper_item_name_wk": f'全路径: {x["分部全路径"]}' if x["分部全路径"] is not None else "",
    "专业预期": x["specialty"],
    "分部分项预期": x["costPartial"],

    "构件预期": ",".join(sorted(set(x["element"].split(",")))) if x["element"] is not None else "",
    "构件属性名称预期": x["element_prop"],
    "构件属性值原始预期": x["element_prop_value"],
    "构件属性值预期": ",".join( sorted( map(lambda x: x["std"], eval(x["element_prop_value"])) ) ) if x["element_prop_value"] is not None else None,

    "构件_属性名称预期": f'{x["element"]}_{x["element_prop"]}',
    "构件_属性名称_属性值预期": ",".join( sorted( map( lambda x: f'{x[1]}_{x[2]}_{x[0]["std"]}' , zip( eval(x["element_prop_value"]), [x["element"],]*len(eval(x["element_prop_value"])), [x["element_prop"],]*len(eval(x["element_prop_value"])) ) ) ) ) if x["element_prop_value"] is not None else None,

    "材料预期": ",".join(sorted(set(x["material"].split(",")))) if x["material"] is not None else "",
    "材料属性名称预期": x["material_prop"],
    "材料属性值原始预期": x["material_prop_value"],
    "材料属性值预期": ",".join( sorted( map(lambda x: x["std"], eval(x["material_prop_value"]) ) , key=lambda x: float(x) if x.replace('.', '', 1).isdigit() else str(x) ) ) if x["material_prop_value"] is not None else None,

    }
keep_exists = True

[dataset_raw_price_library_property_dedup]
class = AccumulateDataset
input = raw_price_library_property_trans
deduplicate_by = list_key

[dataset_raw_price_library_element_property]
class = FilterDataset
input = raw_price_library_property_trans
filters = x["构件属性名称预期"] is not None


[dataset_raw_price_library_element_enum_property]
class = FilterDataset
input = raw_price_library_property_trans
filters = x["构件_属性名称预期"] in ["场地_土壤类别", "场地_场平方式", "土石方_开挖方式", "土石方_回填方式", "土石方_动土方式", "支撑架_内反支撑标志", "支撑架_类别", "桩_截面形状", "脚手架_类别", "脚手架_内外脚手架标志", "脚手架_材质", "脚手架_类型", "幕墙_材质", "幕墙_结构类型", "幕墙_内/外墙标志", "幕墙_类型", "幕墙_房间边界", "幕墙_是否计算防水面积", "屋面_是否有保温", "屋面_类型", "屋面_是否上人", "屋面_是否计算防水面积", "屋面_是否种植", "消防水池_是否计算防水面积", "地沟_材质", "地沟_类型", "采光顶_材质", "蓄水池_是否计算防水面积", "门窗_材质", "屋架_类型", "屋架_类别", "台阶_材料种类", "栏杆扶手_材质", "栏杆扶手_类别", "栏杆扶手_扶手截面形状", "栏杆扶手_栏杆截面形状", "散水_垫层材料种类", "阳台_类别", "设备基础_灌浆材料", "地下连续墙导墙_截面形状", "飘窗_截面形状", "飘窗_材质", "老虎窗_截面形状", "汽车坡道_材质", "防水导墙_类型", "无障碍坡道_材质", "墙_内/外墙标志", "墙_图元形状", "墙_造型标志", "成孔芯模_类别", "板_图元形状", "板_材质", "排水沟_是否计算防水面积", "基础_是否计算防水面积", "基础_类型", "后浇带_后浇带构件种类", "后浇带_后浇带类型", "后浇带_是否预制构件连接处", "梁_截面形状", "梁_图元形状", "组合结构墙_类别", "楼梯_截面形状", "楼梯_图元形状", "楼梯_栏杆扶手设置", "楼梯_楼梯代号", "楼梯_组成", "栏板_截面形状", "栏板_图元形状", "栏板_房间边界", "保温墙_内/外墙标志", "保温墙_图元形状", "保温墙_材质", "保温墙_类别", "挑檐板_类别", "挑檐板_形状", "雨篷_截面形状", "柱_形状", "钢柱_型材截面", "钢柱_焊接截面", "钢柱_清单类型", "钢柱_内部截面", "钢梁_型材截面", "钢梁_焊接截面", "钢板_形式", "钢楼梯_类别", "桩尖_形状", "桩尖_形式", "爬梯_材质", "组合结构柱_类别", "组合结构梁_类别", "组合结构楼板_类别", "车棚_类型", "楼地面_是否有保温", "楼地面_是否计算防水面积", "楼地面_燃烧性能", "楼地面_类型", "踢脚线_所附墙材质", "墙面_所附墙材质", "墙面_是否有保温", "墙面_是否计算防水面积", "墙裙_所附墙材质", "墙裙_内/外墙裙标志", "墙裙_是否计算防水面积", "天棚_是否计算防水面积", "装饰线条_品种", "装饰线条_表面处理", "土方_开挖方式", "土方_土壤类别", "土方_回填方式", "土方_动土方式", "土方_施工方法", "石方_开挖方式", "钢节点_类型", "钢节点_材质", "支护桩_截面形状", "支护桩_类别", "支护桩_材质", "支护桩_截面形状", "支撑梁_类别", "钢格构柱_截面形状", "钢格构柱_缀板圈数", "钢格构柱_材质", "钢支撑_类别", "钢支撑_截面形状", "钢支撑_材质", "护坡_材质", "斜支撑_类型", "地下连续墙_截面形状", "地下连续墙_槽段连接形式", "女儿墙_类型", "女儿墙_是否有保温", "女儿墙_是否计算防水面积", "门_是否随墙变斜", "门_组成", "门_开启方式", "门_材质", "门_安装位置", "门_饰面样式", "门_用途", "门_门扇类型", "门_开启方向", "门_型号", "门_工艺", "门_防火等级", "门_安全等级", "门_阻隔方式", "门_树种", "门_类型", "门_玻璃种类", "门_是否带观察窗", "门_是否后塞口", "门_是否过门石", "门_内/外标识", "窗_类别", "窗_是否随墙变斜", "窗_开启方式", "窗_材质", "窗_用途", "窗_工艺", "窗_型号", "窗_树种", "窗_防火等级", "窗_安全等级", "窗_阻隔方式", "窗_类型", "窗_玻璃种类", "窗_是否后塞口", "窗_框数", "窗_内/外标识", "窗_是否带纱扇", "窗_腔体结构", "窗_是否含百叶", "窗_是否含纱窗", "窗台板_材质", "门联窗_窗位置", "门联窗_是否随墙变斜", "门联窗_材质", "门联窗_用途", "门联窗_工艺", "门联窗_是否后塞口", "门联窗_玻璃种类", "门联窗_安全等级", "栏杆_材质", "栏杆_用途", "扶手_类别", "扶手_扶手截面形状", "扶手_栏杆截面形状", "扶手_材质", "砖胎膜_多阶布置", "预制飘窗_截面形状", "结构墙_内/外墙标志", "结构墙_类别", "结构墙_图元形状", "结构墙_判断短肢剪力墙", "结构墙_是否为短肢剪力墙", "结构墙_房间边界", "结构墙_造型标志", "结构墙_抗渗标志", "结构墙_是否计算防水面积", "结构墙_是否有保温", "挡土墙_截面形状", "挡土墙_图元形状", "隔墙_内/外墙标志", "隔墙_图元形状", "砌体墙_类别", "砌体墙_内/外墙标志", "砌体墙_工艺", "砌体墙_材质", "砌体墙_用途", "砌体墙_图元形状", "预制墙_类别", "预制墙_房间边界", "预制墙_内外墙标志", "预制墙_是否带门窗", "预制墙_有无洞口", "坎墙_材质", "现浇板_结构类别", "现浇板_图元形状", "现浇板_类型", "现浇板_是否叠合", "现浇板_是否计算防水面积", "现浇板_屋面板标识", "盖板_材质", "盖板_类型", "盖板_形状", "盖板_类别", "盖板_是否有保温", "预制板_是否是楼板", "预制板_类型", "预制板_边沿构造", "预制板_是否水平现浇带", "钢板楼板_形式", "板缝_类别", "基础梁_类别", "基础梁_截面形状", "集水坑_是否计算防水面积", "垫层_工艺", "垫层_形状", "筏板基础_类别", "筏板基础_是否计算防水面积", "条形基础_结构类型", "条形基础_是否计算防水面积", "独立基础_类别", "独立基础_是否计算防水面积", "桩承台_是否计算防水面积", "桩基_结构类别", "桩基_截面形状", "桩基_类别", "桩基_挖土类型", "板洞_形状", "结构梁_截面形状", "结构梁_结构类别", "结构梁_定额类别", "结构梁_土建汇总类别", "结构梁_图元形状", "结构梁_是否叠合", "连梁_图元形状", "圈梁_图元形状", "圈梁_位置", "圈梁_截面形状", "圈梁_类型", "预制梁_结构类别", "预制梁_截面形状", "螺旋梯段_旋转方向", "预制楼梯_类别", "预制楼梯_支撑类型", "门后塞口_开启方式", "门后塞口_材质", "门后塞口_安装位置", "门后塞口_饰面样式", "门后塞口_用途", "门后塞口_门扇类型", "门后塞口_开始方向", "门后塞口_防火等级", "门后塞口_安全等级", "门后塞口_类型", "窗后塞口_类别", "窗后塞口_开启方式", "窗后塞口_材质", "窗后塞口_用途", "窗后塞口_工艺", "窗后塞口_型号", "窗后塞口_防火等级", "窗后塞口_安全等级", "窗后塞口_阻隔方式", "窗后塞口_类型", "预制雨篷_截面形状", "结构柱_结构类别", "结构柱_形状", "构造柱_抱框", "构造柱_马牙槎设置", "柱墩_柱墩类型", "柱帽_柱帽类型", "砌体柱_材质", "砌体柱_类型", "预制柱_截面形状", "预制柱_结构类别", "预制柱_定额类别", "实腹钢梁_类别", "内墙面_所附墙材质", "内墙面_是否有保温", "内墙面_是否计算防水面积", "外墙面_所附墙材质", "外墙面_是否有保温", "外墙面_是否计算防水面积", "墙面变形缝_内外墙标志", "柱面_是否计算防水面积", "柱面_内外标志", "柱面_是否有保温", "吊顶_级别", "梁面_内外标志", "钢桩_材质", "钢桩_截面形状", "土钉墙_类型", "锚杆(锚索)_应用形式", "沟盖板_材质", "沟盖板_类型", "沟盖板_是否有保温", "井盖板_材质", "井盖板_类型", "井盖板_是否有保温", "电梯坑_是否计算防水面积", "桩头_是否计算防水面积", "抱框柱_马牙槎设置", "内墙裙_所附墙材质", "内墙裙_是否计算防水面积", "外墙裙_所附墙材质", "外墙裙_是否计算防水面积"]

[stage_raw_price_library_element_enum_property_export]
class = DatasetExportStage
dataset = raw_price_library_element_enum_property
output_fields = pid, list_key, upper_item_name, item_name, item_feature, 分部分项预期, 构件预期, 构件属性名称预期, 构件属性值原始预期, 构件属性值预期, 构件_属性名称_属性值预期
output_names = 工程id, 清单id, 上级名称, 清单名称, 清单特征, 分部分项预期, 构件预期, 构件属性名称预期, 构件属性值原始预期, 构件属性值预期, 构件_属性名称_属性值预期
save_res_path = /home/shilei/fbpmx/list_extract/pricelib_property_${date}/raw_price_library_element_enum_property_export_${date}.xlsx


[dataset_raw_price_library_element_num_property]
class = FilterDataset
input = raw_price_library_element_property
filters = x["构件_属性名称预期"] not in ["场地_土壤类别", "场地_场平方式", "土石方_开挖方式", "土石方_回填方式", "土石方_动土方式", "支撑架_内反支撑标志", "支撑架_类别", "桩_截面形状", "脚手架_类别", "脚手架_内外脚手架标志", "脚手架_材质", "脚手架_类型", "幕墙_材质", "幕墙_结构类型", "幕墙_内/外墙标志", "幕墙_类型", "幕墙_房间边界", "幕墙_是否计算防水面积", "屋面_是否有保温", "屋面_类型", "屋面_是否上人", "屋面_是否计算防水面积", "屋面_是否种植", "消防水池_是否计算防水面积", "地沟_材质", "地沟_类型", "采光顶_材质", "蓄水池_是否计算防水面积", "门窗_材质", "屋架_类型", "屋架_类别", "台阶_材料种类", "栏杆扶手_材质", "栏杆扶手_类别", "栏杆扶手_扶手截面形状", "栏杆扶手_栏杆截面形状", "散水_垫层材料种类", "阳台_类别", "设备基础_灌浆材料", "地下连续墙导墙_截面形状", "飘窗_截面形状", "飘窗_材质", "老虎窗_截面形状", "汽车坡道_材质", "防水导墙_类型", "无障碍坡道_材质", "墙_内/外墙标志", "墙_图元形状", "墙_造型标志", "成孔芯模_类别", "板_图元形状", "板_材质", "排水沟_是否计算防水面积", "基础_是否计算防水面积", "基础_类型", "后浇带_后浇带构件种类", "后浇带_后浇带类型", "后浇带_是否预制构件连接处", "梁_截面形状", "梁_图元形状", "组合结构墙_类别", "楼梯_截面形状", "楼梯_图元形状", "楼梯_栏杆扶手设置", "楼梯_楼梯代号", "楼梯_组成", "栏板_截面形状", "栏板_图元形状", "栏板_房间边界", "保温墙_内/外墙标志", "保温墙_图元形状", "保温墙_材质", "保温墙_类别", "挑檐板_类别", "挑檐板_形状", "雨篷_截面形状", "柱_形状", "钢柱_型材截面", "钢柱_焊接截面", "钢柱_清单类型", "钢柱_内部截面", "钢梁_型材截面", "钢梁_焊接截面", "钢板_形式", "钢楼梯_类别", "桩尖_形状", "桩尖_形式", "爬梯_材质", "组合结构柱_类别", "组合结构梁_类别", "组合结构楼板_类别", "车棚_类型", "楼地面_是否有保温", "楼地面_是否计算防水面积", "楼地面_燃烧性能", "楼地面_类型", "踢脚线_所附墙材质", "墙面_所附墙材质", "墙面_是否有保温", "墙面_是否计算防水面积", "墙裙_所附墙材质", "墙裙_内/外墙裙标志", "墙裙_是否计算防水面积", "天棚_是否计算防水面积", "装饰线条_品种", "装饰线条_表面处理", "土方_开挖方式", "土方_土壤类别", "土方_回填方式", "土方_动土方式", "土方_施工方法", "石方_开挖方式", "钢节点_类型", "钢节点_材质", "支护桩_截面形状", "支护桩_类别", "支护桩_材质", "支护桩_截面形状", "支撑梁_类别", "钢格构柱_截面形状", "钢格构柱_缀板圈数", "钢格构柱_材质", "钢支撑_类别", "钢支撑_截面形状", "钢支撑_材质", "护坡_材质", "斜支撑_类型", "地下连续墙_截面形状", "地下连续墙_槽段连接形式", "女儿墙_类型", "女儿墙_是否有保温", "女儿墙_是否计算防水面积", "门_是否随墙变斜", "门_组成", "门_开启方式", "门_材质", "门_安装位置", "门_饰面样式", "门_用途", "门_门扇类型", "门_开启方向", "门_型号", "门_工艺", "门_防火等级", "门_安全等级", "门_阻隔方式", "门_树种", "门_类型", "门_玻璃种类", "门_是否带观察窗", "门_是否后塞口", "门_是否过门石", "门_内/外标识", "窗_类别", "窗_是否随墙变斜", "窗_开启方式", "窗_材质", "窗_用途", "窗_工艺", "窗_型号", "窗_树种", "窗_防火等级", "窗_安全等级", "窗_阻隔方式", "窗_类型", "窗_玻璃种类", "窗_是否后塞口", "窗_框数", "窗_内/外标识", "窗_是否带纱扇", "窗_腔体结构", "窗_是否含百叶", "窗_是否含纱窗", "窗台板_材质", "门联窗_窗位置", "门联窗_是否随墙变斜", "门联窗_材质", "门联窗_用途", "门联窗_工艺", "门联窗_是否后塞口", "门联窗_玻璃种类", "门联窗_安全等级", "栏杆_材质", "栏杆_用途", "扶手_类别", "扶手_扶手截面形状", "扶手_栏杆截面形状", "扶手_材质", "砖胎膜_多阶布置", "预制飘窗_截面形状", "结构墙_内/外墙标志", "结构墙_类别", "结构墙_图元形状", "结构墙_判断短肢剪力墙", "结构墙_是否为短肢剪力墙", "结构墙_房间边界", "结构墙_造型标志", "结构墙_抗渗标志", "结构墙_是否计算防水面积", "结构墙_是否有保温", "挡土墙_截面形状", "挡土墙_图元形状", "隔墙_内/外墙标志", "隔墙_图元形状", "砌体墙_类别", "砌体墙_内/外墙标志", "砌体墙_工艺", "砌体墙_材质", "砌体墙_用途", "砌体墙_图元形状", "预制墙_类别", "预制墙_房间边界", "预制墙_内外墙标志", "预制墙_是否带门窗", "预制墙_有无洞口", "坎墙_材质", "现浇板_结构类别", "现浇板_图元形状", "现浇板_类型", "现浇板_是否叠合", "现浇板_是否计算防水面积", "现浇板_屋面板标识", "盖板_材质", "盖板_类型", "盖板_形状", "盖板_类别", "盖板_是否有保温", "预制板_是否是楼板", "预制板_类型", "预制板_边沿构造", "预制板_是否水平现浇带", "钢板楼板_形式", "板缝_类别", "基础梁_类别", "基础梁_截面形状", "集水坑_是否计算防水面积", "垫层_工艺", "垫层_形状", "筏板基础_类别", "筏板基础_是否计算防水面积", "条形基础_结构类型", "条形基础_是否计算防水面积", "独立基础_类别", "独立基础_是否计算防水面积", "桩承台_是否计算防水面积", "桩基_结构类别", "桩基_截面形状", "桩基_类别", "桩基_挖土类型", "板洞_形状", "结构梁_截面形状", "结构梁_结构类别", "结构梁_定额类别", "结构梁_土建汇总类别", "结构梁_图元形状", "结构梁_是否叠合", "连梁_图元形状", "圈梁_图元形状", "圈梁_位置", "圈梁_截面形状", "圈梁_类型", "预制梁_结构类别", "预制梁_截面形状", "螺旋梯段_旋转方向", "预制楼梯_类别", "预制楼梯_支撑类型", "门后塞口_开启方式", "门后塞口_材质", "门后塞口_安装位置", "门后塞口_饰面样式", "门后塞口_用途", "门后塞口_门扇类型", "门后塞口_开始方向", "门后塞口_防火等级", "门后塞口_安全等级", "门后塞口_类型", "窗后塞口_类别", "窗后塞口_开启方式", "窗后塞口_材质", "窗后塞口_用途", "窗后塞口_工艺", "窗后塞口_型号", "窗后塞口_防火等级", "窗后塞口_安全等级", "窗后塞口_阻隔方式", "窗后塞口_类型", "预制雨篷_截面形状", "结构柱_结构类别", "结构柱_形状", "构造柱_抱框", "构造柱_马牙槎设置", "柱墩_柱墩类型", "柱帽_柱帽类型", "砌体柱_材质", "砌体柱_类型", "预制柱_截面形状", "预制柱_结构类别", "预制柱_定额类别", "实腹钢梁_类别", "内墙面_所附墙材质", "内墙面_是否有保温", "内墙面_是否计算防水面积", "外墙面_所附墙材质", "外墙面_是否有保温", "外墙面_是否计算防水面积", "墙面变形缝_内外墙标志", "柱面_是否计算防水面积", "柱面_内外标志", "柱面_是否有保温", "吊顶_级别", "梁面_内外标志", "钢桩_材质", "钢桩_截面形状", "土钉墙_类型", "锚杆(锚索)_应用形式", "沟盖板_材质", "沟盖板_类型", "沟盖板_是否有保温", "井盖板_材质", "井盖板_类型", "井盖板_是否有保温", "电梯坑_是否计算防水面积", "桩头_是否计算防水面积", "抱框柱_马牙槎设置", "内墙裙_所附墙材质", "内墙裙_是否计算防水面积", "外墙裙_所附墙材质", "外墙裙_是否计算防水面积"]


[stage_raw_price_library_element_num_property_export]
class = DatasetExportStage
dataset = raw_price_library_element_num_property
output_fields = pid, list_key, upper_item_name, item_name, item_feature, 分部分项预期, 构件预期, 构件属性名称预期, 构件属性值原始预期, 构件属性值预期
output_names = 工程id, 清单id, 上级名称, 清单名称, 清单特征, 分部分项预期, 构件预期, 构件属性名称预期, 构件属性值原始预期, 构件属性值预期
save_res_path = /home/shilei/fbpmx/list_extract/pricelib_property_${date}/raw_price_library_element_num_property_export_${date}.xlsx

