[DEFAULT]
workspace = /home/shilei/fbpmx/list_extract/pricelib_property_${date}

[project]
actions = generate
datasets = raw_price_library_property_dedup, price_library_20254_element_property

[dataset_raw_price_library_property]
class = ReadExcelLackKeyDataset
key_cols = uid
feature_cols = costPartial, element, material, sequence
dir = /home/shilei/corpus/cost_split/分包指导价属性/05-中交一公局北京建筑-土建-解析预期结果(工程数据分包指导价).xlsx, /home/shilei/corpus/cost_split/分包指导价属性/08-一冶-土建-解析预期结果(工程数据分包指导价).xlsx

[dataset_raw_price_library_property_trans]
class = MapDataset
input = raw_price_library_property
expression = exec('import re; import uuid') or {"item_id": uuid.uuid3(uuid.NAMESPACE_DNS, str(x["filepath"]).split("/")[-1].split("-解析预期结果")[0] + "-" + str(x["uid"])).hex,
    "uid": str(x["uid"]),
    "list_key": str(x["filepath"]).split("/")[-1].split("-解析预期结果")[0] + "-" + str(x["uid"]),
    "item_name": x["名称"],
    "item_feature": x["项目特征"],
    "upper_item_name": x["分部全路径"],
    "pid": str(x["filepath"]).split("/")[-1].split("-解析预期结果")[0],
    "item_name_wk": f'清单名称: {x["名称"]}' if x["名称"] is not None else "",
    "item_feature_wk": f'清单特征: {x["项目特征"]}' if x["项目特征"] is not None else "",
    "upper_item_name_wk": f'全路径: {x["分部全路径"]}' if x["分部全路径"] is not None else "",
    "专业预期": x["specialty"],
    "分部分项预期": x["costPartial"],
    "构件预期": ",".join(sorted(set(x["element"].split(",")))) if x["element"] is not None else "",
    "构件属性名称预期": x["element_prop"],
    "构件属性值预期": x["element_prop_value"],
    "材料预期": ",".join(sorted(set(x["material"].split(",")))) if x["material"] is not None else "",
    "材料属性名称预期": x["material_prop"],
    "材料属性值预期": x["material_prop_value"],
    }
keep_exists = True

[dataset_raw_price_library_property_dedup]
class = AccumulateDataset
input = raw_price_library_property_trans
deduplicate_by = list_key

[dataset_price_library_20254_element_property]
class = FilterDataset
input = raw_price_library_property_trans
filters = x["构件属性名称预期"] is not None