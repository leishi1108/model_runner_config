[DEFAULT]
workspace = /home/shilei/fbpmx/element_p2p_cross_validation/GTJ_history60w_element_p2p_cross_validation_${date}

[project]
actions = generate, evaluate
datasets = history60w_data, history60w_data_sample
evaluators = cross_validation_predict


[dataset_raw_history60w_data]
class = ReadFileDataset
format = json
dir = /data/yujh/llm/LLaMA-Factory-main/data/list_item_subject_data_train_prompt_with_brief_filter.json


[dataset_history60w_data]
class = MapDataset
input = raw_history60w_data
expression = exec('import re; import uuid') or {
        "project_id": str(x["project_id"]),
        "list_key": str(x["bq_item_key"]),
        "item_name": str(x["bq_item_content"]),
        "item_feature": str(x["bq_item_spec"]) if x["bq_item_spec"] is not None else "",
        "upper_item_name": str(x["bq_item_title_with_upper"]).replace("\n", "").replace("\r", "").replace("\t", "") if x["bq_item_title_with_upper"] is not None else "",
        "project_name": "",
        "task_type": "清单", 
    }
keep_exists = True


[dataset_history60w_data_sample]
class = FilterDataset
input = history60w_data
filters = ("project_id" in x) and ( int(x["project_id"][-5:],16) % 100 < 2 )


[model_doubao_element_e2e]
class = DoubaoElementE2EModel
url = http://10.0.79.55:9001
item_name_key = item_name
item_feature_key = item_feature
upper_item_name_key = upper_item_name
project_name_key = project_name
task_type_key = task_type
need_fields = item_name, item_feature, upper_item_name, project_name, task_type
re_predict = False

[model_tjqd2]
class = GDETJQD2ServiceModel
task_type = 清单
item_name_key = item_name
item_feature_key = item_feature
upper_item_name_key = upper_item_name
project_name_key = project_name
need_fields = item_name,item_feature,upper_item_name,project_name
re_predict = False

[evaluator_cross_validation_predict]
class = SimplePredictor
datasets = history60w_data_sample
models = doubao_element_e2e, tjqd2
num_workers = 2

